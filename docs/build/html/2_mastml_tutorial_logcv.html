

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Random leave-out versus leave-out-group cross-validation &mdash; MAterials Simulation Toolkit for Machine Learning (MAST-ML) 2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Making predictions by importing a previously fit model" href="2_mastml_tutorial_modelimport.html" />
    <link rel="prev" title="Hyperparameter optimization" href="2_mastml_tutorial_hyperparam.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> MAterials Simulation Toolkit for Machine Learning (MAST-ML)
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="00_acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="0_installation.html">Installing MAST-ML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="0_1_hardware_data_requirements.html">Hardware and Data Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0_1_hardware_data_requirements.html#hardware">Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="0_1_hardware_data_requirements.html#data">Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0_1_terminal_installation.html">Terminal installation (Linux or linux-like terminal on Mac)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0_1_terminal_installation.html#install-python3">Install Python3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0_1_terminal_installation.html#create-a-conda-environment">Create a conda environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="0_1_terminal_installation.html#set-up-juptyer-notebooks">Set up Juptyer notebooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0_1_terminal_installation.html#install-the-mast-ml-package">Install the MAST-ML package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0_1_terminal_installation.html#imports-that-dont-work">Imports that don’t work</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0_2_windows_installation.html">Windows installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0_2_windows_installation.html#install-python3">Install Python3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0_2_windows_installation.html#create-a-conda-environment">Create a conda environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="0_2_windows_installation.html#set-up-the-spyder-ide-and-jupyter-notebooks">Set up the Spyder IDE and Jupyter notebooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0_2_windows_installation.html#install-the-mast-ml-package">Install the MAST-ML package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0_2_windows_installation.html#imports-that-dont-work">Imports that don’t work</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0_3_startup.html">Startup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0_3_startup.html#locate-the-examples-folder">Locate the examples folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="0_3_startup.html#run-the-mastml-command">Run the MASTML command</a></li>
<li class="toctree-l3"><a class="reference internal" href="0_3_startup.html#check-output">Check output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="1_mastml_inputfile.html">MAST-ML Input File</a><ul>
<li class="toctree-l2"><a class="reference internal" href="1_mastml_inputfile.html#input-file-sections">Input file sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#general-setup">General Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#data-cleaning">Data Cleaning</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#clustering">Clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#feature-generation">Feature Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#feature-normalization">Feature Normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#learning-curve">Learning Curve</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#feature-selection">Feature Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#data-splits">Data Splits</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#models">Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="1_mastml_inputfile.html#plot-settings">Plot Settings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2_mastml_overview.html">MAST-ML overview slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_running_mastml_nanohub.html">Running MAST-ML on Nanohub</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="2_mastml_tutorial.html">MAST-ML tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_firstrun.html">Your first MAST-ML run</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_cleaning.html">Cleaning input data</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_featuregen.html">Feature generation and normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_firstmodel.html">Training and evaluating your first model</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_featureselect.html">Feature selection and learning curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_hyperparam.html">Hyperparameter optimization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Random leave-out versus leave-out-group cross-validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_modelimport.html">Making predictions by importing a previously fit model</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_mastml_tutorial_prediction.html">Predicting values for new, extrapolated data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3_code_documentation.html">MAST-ML Code Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3_metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_conf_parser.html">Configuration file parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_data_cleaner.html">Data cleaner</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_data_loader.html">Data loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_learning_curve.html">Learning curve</a></li>
<li class="toctree-l2"><a class="reference internal" href="8_clusterers.html">Clusterers</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_data_splitters.html">Data splitters</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_utils.html">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_mastml_driver.html">MAST-ML Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_plot_helper.html">Plot Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_html_helper.html">HTML Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_feature_selectors.html">Feature Selectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="15_feature_normalizers.html">Feature Normalizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="16_randomizers.html">Randomizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="17_model_finder.html">Model Finder</a></li>
<li class="toctree-l2"><a class="reference internal" href="18_util_legos.html">Utility Legos</a></li>
<li class="toctree-l2"><a class="reference internal" href="19_feature_generators.html">Feature Generators</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MAterials Simulation Toolkit for Machine Learning (MAST-ML)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="2_mastml_tutorial.html">MAST-ML tutorial</a> &raquo;</li>
        
      <li>Random leave-out versus leave-out-group cross-validation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/2_mastml_tutorial_logcv.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="random-leave-out-versus-leave-out-group-cross-validation">
<h1>Random leave-out versus leave-out-group cross-validation<a class="headerlink" href="#random-leave-out-versus-leave-out-group-cross-validation" title="Permalink to this headline">¶</a></h1>
<p>Here, we will use our selected feature set and optimized KernelRidge hyperparameters from the previous section to do a
new kind of cross-validation test: leave out group (LOG) CV. To do this, you will modify the alpha and gamma values in the
Models section, KernelRidge model in your input file. In addition, you can rename the selected.csv data file to a
new name, for example “example_data_selected.csv”, and use the path to this new data file for this new run, as we
will not be performing feature selection again (to save time).</p>
<p>We will compare these results to the results of LOG cross-validation with the random cross-validation. Our input data file
had a column called “Host element”. This is a natural grouping to use for this problem, as it is interesting to assess our
fits when training on a set of host elements and predicted the values of an entirely new host element set, without having
ever trained on that set. Modify your input file to match what is shown below. Note that we have commented out the sections
that we no longer want with the # symbol. You can either comment out the sections or remove them entirely.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">GeneralSetup</span><span class="p">]</span>
    <span class="n">input_features</span> <span class="o">=</span> <span class="n">Auto</span>
    <span class="n">target_feature</span> <span class="o">=</span> <span class="n">Reduced</span> <span class="n">barrier</span> <span class="p">(</span><span class="n">eV</span><span class="p">)</span>
    <span class="n">randomizer</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">Auto</span>
    <span class="n">not_input_features</span> <span class="o">=</span> <span class="n">Host</span> <span class="n">element</span><span class="p">,</span> <span class="n">Solute</span> <span class="n">element</span><span class="p">,</span> <span class="n">predict_Pt</span>
    <span class="n">grouping_feature</span> <span class="o">=</span> <span class="n">Host</span> <span class="n">element</span>

<span class="c1">#[DataCleaning]</span>
<span class="c1">#    cleaning_method = imputation</span>
<span class="c1">#    imputation_strategy = mean</span>

<span class="c1">#[FeatureGeneration]</span>
<span class="c1">#    [[Magpie]]</span>
<span class="c1">#        composition_feature = Solute element</span>

<span class="p">[</span><span class="n">FeatureNormalization</span><span class="p">]</span>
    <span class="p">[[</span><span class="n">StandardScaler</span><span class="p">]]</span>

<span class="c1">#[FeatureSelection]</span>
<span class="c1">#    [[SequentialFeatureSelector]]</span>
<span class="c1">#        estimator = KernelRidge_select</span>
<span class="c1">#        k_features = 20</span>

<span class="c1">#[LearningCurve]</span>
<span class="c1">#    estimator = KernelRidge_learn</span>
<span class="c1">#    cv = RepeatedKFold_learn</span>
<span class="c1">#    scoring = root_mean_squared_error</span>
<span class="c1">#    n_features_to_select = 20</span>
<span class="c1">#    selector_name = SelectKBest</span>

<span class="p">[</span><span class="n">Models</span><span class="p">]</span>
    <span class="p">[[</span><span class="n">KernelRidge</span><span class="p">]]</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">rbf</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.034</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.138</span>
    <span class="c1">#[[KernelRidge_select]]</span>
    <span class="c1">#    kernel = rbf</span>
    <span class="c1">#    alpha = 1</span>
    <span class="c1">#    gamma = 1</span>
    <span class="c1">#[[KernelRidge_learn]]</span>
    <span class="c1">#    kernel = rbf</span>
    <span class="c1">#    alpha = 1</span>
    <span class="c1">#    gamma = 1</span>

<span class="p">[</span><span class="n">DataSplits</span><span class="p">]</span>
    <span class="p">[[</span><span class="n">NoSplit</span><span class="p">]]</span>
    <span class="p">[[</span><span class="n">RepeatedKFold</span><span class="p">]]</span>
        <span class="n">n_splits</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">n_repeats</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c1">#[[RepeatedKFold_learn]]</span>
    <span class="c1">#    n_splits = 5</span>
    <span class="c1">#    n_repeats = 2</span>
    <span class="p">[[</span><span class="n">LeaveOneGroupOut</span><span class="p">]]</span>
        <span class="n">grouping_column</span> <span class="o">=</span> <span class="n">Host</span> <span class="n">element</span>

<span class="c1">#[HyperOpt]</span>
<span class="c1">#    [[GridSearch]]</span>
<span class="c1">#        estimator = KernelRidge</span>
<span class="c1">#        cv = RepeatedKFold</span>
<span class="c1">#        param_names = alpha ; gamma</span>
<span class="c1">#        param_values = -5 5 100 log ; -5 5 100 log</span>
<span class="c1">#        scoring = root_mean_squared_error</span>
</pre></div>
</div>
<p>The main new additions to this input file is under the General Setup section, where the parameter grouping_feature needs
to be added, and the addition of LeaveOutGroup to the DataSplits section.</p>
<p>By doing this run, we can assess the model fits resulting from the random cross-validation and the LOG cross-validation.</p>
<p>Random cross-validation:</p>
<img alt="_images/MASTMLtutorial_run7_1.png" src="_images/MASTMLtutorial_run7_1.png" />
<p>LOG cross-validation:</p>
<img alt="_images/MASTMLtutorial_run7_2.png" src="_images/MASTMLtutorial_run7_2.png" />
<p>We can immediately see the R-squared and errors are both worse for the LOG cross-validation test compared to the random
cross-validation test. This is likely because the LOG test is a more rigorous test of model extrapolation, because the test
scores in each case are for data for which host elements were never included in the training set. In addition, a minor
effect contributing to the reduced accuracy may be due to the fact that the model hyperparameters were optimized by evaluating
the root mean squared error for a random cross-validation test. If instead the parameters were optimized using the LOG test,
the resulting fits would likely be improved.</p>
<p>There are a couple additional plots that are usual output for a LOG test that are worth drawing attention to. The first
is a plot of each metric test value for each group. This enables one to quickly assess which groups perform better or worse
than others.</p>
<img alt="_images/MASTMLtutorial_run7_3.png" src="_images/MASTMLtutorial_run7_3.png" />
<p>In addition, the parity plots for each split are now plotted with symbols denoting each group, which can help assess clustering
of groups and goodness of fit on a per-group basis.</p>
<p>Training on all groups except Ag:</p>
<img alt="_images/MASTMLtutorial_run7_4.png" src="_images/MASTMLtutorial_run7_4.png" />
<p>Testing on just Ag as the left-out host element:</p>
<img alt="_images/MASTMLtutorial_run7_5.png" src="_images/MASTMLtutorial_run7_5.png" />
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2_mastml_tutorial_modelimport.html" class="btn btn-neutral float-right" title="Making predictions by importing a previously fit model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="2_mastml_tutorial_hyperparam.html" class="btn btn-neutral" title="Hyperparameter optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, University of Wisconsin-Madison Computational Materials Group

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>