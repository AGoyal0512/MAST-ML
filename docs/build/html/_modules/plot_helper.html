
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>plot_helper &#8212; MAterials Simulation Toolkit for Machine Learning (MAST-ML) 2.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for plot_helper</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains a collection of functions which make plots (saved as png files) using matplotlib, generated from</span>
<span class="sd">some model fits and cross-validation evaluation within a MAST-ML run.</span>

<span class="sd">This module also contains a method to create python notebooks containing plotted data and the relevant source code from</span>
<span class="sd">this module, to enable the user to make their own modifications to the created plots in a straightforward way (useful for</span>
<span class="sd">tweaking plots for a presentation or publication).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>

<span class="c1"># Ignore the harmless warning about the gelsd driver on mac.</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="s2">&quot;scipy&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="s2">&quot;^internal gelsd&quot;</span><span class="p">)</span>
<span class="c1"># Ignore matplotlib deprecation warning (set as all warnings for now)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">precision_recall_curve</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_agg</span> <span class="k">import</span> <span class="n">FigureCanvasAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span><span class="p">,</span> <span class="n">figaspect</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="k">import</span> <span class="n">FuncAnimation</span>
<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="k">import</span> <span class="n">FontProperties</span>
<span class="kn">import</span> <span class="nn">matplotlib.mlab</span> <span class="k">as</span> <span class="nn">mlab</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="k">import</span> <span class="n">mark_inset</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="k">import</span> <span class="n">zoomed_inset_axes</span>

<span class="c1"># Needed imports for ipynb_maker</span>
<span class="kn">from</span> <span class="nn">mastml.utils</span> <span class="k">import</span> <span class="n">nice_range</span>
<span class="kn">from</span> <span class="nn">mastml.metrics</span> <span class="k">import</span> <span class="n">nice_names</span>

<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>

<span class="kn">import</span> <span class="nn">nbformat</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">)</span> <span class="c1"># set all font to bigger</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">autolayout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># turn on autolayout</span>

<span class="c1"># adding dpi as a constant global so it can be changed later</span>
<span class="n">DPI</span> <span class="o">=</span> <span class="mi">250</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span> <span class="c1"># only used inside ipynb_maker I guess</span>

<span class="c1"># HEADERENDER don&#39;t delete this line, it&#39;s used by ipynb maker</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;mastml&#39;</span><span class="p">)</span> <span class="c1"># the real logger</span>

<div class="viewcode-block" id="ipynb_maker"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.ipynb_maker">[docs]</a><span class="k">def</span> <span class="nf">ipynb_maker</span><span class="p">(</span><span class="n">plot_func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method creates Jupyter Notebooks so user can modify and regenerate the plots produced by MAST-ML.</span>

<span class="sd">    Args:</span>

<span class="sd">        plot_func: (plot_helper method), a plotting method contained in plot_helper.py which contains the</span>

<span class="sd">        @ipynb_maker decorator</span>

<span class="sd">    Returns:</span>

<span class="sd">        (plot_helper method), the same plot_func as used as input, but after having written the Jupyter notebook with source code to create plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">mastml</span> <span class="k">import</span> <span class="n">plot_helper</span> <span class="c1"># Strange self-import but it works, as had cyclic import issues with ipynb_maker as its own module</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">plot_func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># convert everything to kwargs for easier display</span>
        <span class="c1"># from geniuses at https://stackoverflow.com/a/831164</span>
        <span class="c1">#kwargs.update(dict(zip(plot_func.func_code.co_varnames, args)))</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">plot_func</span><span class="p">)</span>
        <span class="n">binding</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">all_args</span> <span class="o">=</span> <span class="n">binding</span><span class="o">.</span><span class="n">arguments</span>

        <span class="c1"># if this is an outdir style function, fill in savepath and delete outdir</span>
        <span class="k">if</span> <span class="s1">&#39;savepath&#39;</span> <span class="ow">in</span> <span class="n">all_args</span><span class="p">:</span>
            <span class="n">ipynb_savepath</span> <span class="o">=</span> <span class="n">all_args</span><span class="p">[</span><span class="s1">&#39;savepath&#39;</span><span class="p">]</span>
            <span class="n">knows_savepath</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ipynb_savepath</span><span class="p">)</span> <span class="c1"># fix absolute path problem</span>
        <span class="k">elif</span> <span class="s1">&#39;outdir&#39;</span> <span class="ow">in</span> <span class="n">all_args</span><span class="p">:</span>
            <span class="n">knows_savepath</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">plot_func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">ipynb_savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_args</span><span class="p">[</span><span class="s1">&#39;outdir&#39;</span><span class="p">],</span> <span class="n">basename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;you must have an &quot;outdir&quot; or &quot;savepath&quot; argument to use ipynb_maker&#39;</span><span class="p">)</span>

        <span class="n">readme</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            This notebook was automatically generated from your MAST-ML run so you can recreate the</span>
<span class="s2">            plots. Some things are a bit different from the usual way of creating plots - we are</span>
<span class="s2">            using the [object oriented</span>
<span class="s2">            interface](https://matplotlib.org/tutorials/introductory/lifecycle.html) instead of</span>
<span class="s2">            pyplot to create the `fig` and `ax` instances.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># get source of the top of plot_helper.py</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">plot_helper</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;HEADERENDER&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="n">line</span>

        <span class="n">core_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_helper</span><span class="o">.</span><span class="n">stat_to_string</span><span class="p">,</span> <span class="n">plot_helper</span><span class="o">.</span><span class="n">plot_stats</span><span class="p">,</span> <span class="n">plot_helper</span><span class="o">.</span><span class="n">make_fig_ax</span><span class="p">]</span>
        <span class="n">func_strings</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">core_funcs</span><span class="p">)</span>

        <span class="n">plot_func_string</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">plot_func</span><span class="p">)</span>
        <span class="c1"># remove first line that has this decorator on it (!!!)</span>
        <span class="n">plot_func_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_func_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="c1"># put the arguments and their values in the code</span>
        <span class="n">arg_assignments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arg_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">all_args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
                <span class="c1"># this is amazing</span>
                <span class="n">arg_assignments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{key}</span><span class="s2"> = pd.read_csv(StringIO(&#39;&#39;&#39;</span><span class="se">\n</span><span class="s2">{var.to_csv(index=False)}&#39;&#39;&#39;))&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
                <span class="n">arg_assignments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{key}</span><span class="s2"> = pd.Series(pd.read_csv(StringIO(&#39;&#39;&#39;</span><span class="se">\n</span><span class="s2">{var.to_csv(index=False)}&#39;&#39;&#39;)).iloc[:,0])&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arg_assignments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{key}</span><span class="s1"> = {repr(var)}&#39;</span><span class="p">)</span>
            <span class="n">arg_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">args_block</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;from numpy import array</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;from collections import OrderedDict</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;from io import StringIO</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_assignments</span><span class="p">))</span>
        <span class="n">arg_names</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">knows_savepath</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                import pandas as pd</span>
<span class="s2">                from IPython.display import Image, display</span>

<span class="s2">                </span><span class="si">{plot_func.__name__}</span><span class="s2">(</span><span class="si">{arg_names}</span><span class="s2">)</span>
<span class="s2">                display(Image(filename=&#39;</span><span class="si">{basename}</span><span class="s2">&#39;))</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                import pandas as pd</span>
<span class="s2">                from IPython.display import Image, display</span>

<span class="s2">                plot_paths = plot_predicted_vs_true(train_triple, test_triple, outdir)</span>
<span class="s2">                for plot_path in plot_paths:</span>
<span class="s2">                    display(Image(filename=plot_path))</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">nb</span> <span class="o">=</span> <span class="n">nbformat</span><span class="o">.</span><span class="n">v4</span><span class="o">.</span><span class="n">new_notebook</span><span class="p">()</span>
        <span class="n">readme_cell</span> <span class="o">=</span> <span class="n">nbformat</span><span class="o">.</span><span class="n">v4</span><span class="o">.</span><span class="n">new_markdown_cell</span><span class="p">(</span><span class="n">readme</span><span class="p">)</span>
        <span class="n">text_cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">,</span> <span class="n">func_strings</span><span class="p">,</span> <span class="n">plot_func_string</span><span class="p">,</span> <span class="n">args_block</span><span class="p">,</span> <span class="n">main</span><span class="p">]</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">readme_cell</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">nbformat</span><span class="o">.</span><span class="n">v4</span><span class="o">.</span><span class="n">new_code_cell</span><span class="p">(</span><span class="n">cell_text</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell_text</span> <span class="ow">in</span> <span class="n">text_cells</span><span class="p">]</span>
        <span class="n">nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cells</span>
        <span class="n">nbformat</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">ipynb_savepath</span> <span class="o">+</span> <span class="s1">&#39;.ipynb&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plot_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span></div>

<div class="viewcode-block" id="make_train_test_plots"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.make_train_test_plots">[docs]</a><span class="k">def</span> <span class="nf">make_train_test_plots</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">is_classification</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_X</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General plotting method used to execute sequence of specific plots of train-test data analysis</span>

<span class="sd">    Args:</span>

<span class="sd">        run: (dict), a particular split_result from masml_driver</span>

<span class="sd">        path: (str), path to save the generated plots and analysis of split_result designated in &#39;run&#39;</span>

<span class="sd">        is_classification: (bool), whether or not the analysis is a classification task</span>

<span class="sd">        label: (str), name of the y data variable being fit</span>

<span class="sd">        model: (scikit-learn model object), a scikit-learn model/estimator</span>

<span class="sd">        train_X: (numpy array), array of X features used in training</span>

<span class="sd">        test_X: (numpy array), array of X features used in testing</span>

<span class="sd">        groups: (numpy array), array of group names</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">y_test_true</span> <span class="o">=</span> \
        <span class="n">run</span><span class="p">[</span><span class="s1">&#39;y_train_true&#39;</span><span class="p">],</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;y_train_pred&#39;</span><span class="p">],</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;y_test_true&#39;</span><span class="p">]</span>
    <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span> <span class="o">=</span> \
        <span class="n">run</span><span class="p">[</span><span class="s1">&#39;y_test_pred&#39;</span><span class="p">],</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;train_metrics&#39;</span><span class="p">],</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;test_metrics&#39;</span><span class="p">]</span>
    <span class="n">train_groups</span><span class="p">,</span> <span class="n">test_groups</span> <span class="o">=</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;train_groups&#39;</span><span class="p">],</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;test_groups&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_classification</span><span class="p">:</span>
        <span class="c1"># Need these class prediction probabilities for ROC curve analysis</span>
        <span class="n">y_train_pred_proba</span> <span class="o">=</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;y_train_pred_proba&#39;</span><span class="p">]</span>
        <span class="n">y_test_pred_proba</span> <span class="o">=</span> <span class="n">run</span><span class="p">[</span><span class="s1">&#39;y_test_pred_proba&#39;</span><span class="p">]</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;train_confusion_matrix&#39;</span>
        <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">train_metrics</span><span class="p">,</span>
                              <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;test_confusion_matrix&#39;</span>
        <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">test_metrics</span><span class="p">,</span>
                              <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;train_roc_curve&#39;</span>
        <span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred_proba</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;png&#39;</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;test_roc_curve&#39;</span>
        <span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred_proba</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;png&#39;</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;train_precision_recall_curve&#39;</span>
        <span class="n">plot_precision_recall_curve</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred_proba</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;png&#39;</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;test_precision_recall_curve&#39;</span>
        <span class="n">plot_precision_recall_curve</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred_proba</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;png&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># is_regression</span>
        <span class="n">plot_predicted_vs_true</span><span class="p">((</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">train_groups</span><span class="p">),</span>
                          <span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span>  <span class="n">y_test_pred</span><span class="p">,</span>  <span class="n">test_metrics</span><span class="p">,</span> <span class="n">test_groups</span><span class="p">),</span> 
                          <span class="n">path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;train_normalized_error&#39;</span>
        <span class="n">plot_normalized_error</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_X</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;test_normalized_error&#39;</span>
        <span class="n">plot_normalized_error</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">model</span><span class="p">,</span> <span class="n">test_X</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;train_cumulative_normalized_error&#39;</span>
        <span class="n">plot_cumulative_normalized_error</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_X</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;test_cumulative_normalized_error&#39;</span>
        <span class="n">plot_cumulative_normalized_error</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">model</span><span class="p">,</span> <span class="n">test_X</span><span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;train_residuals_histogram&#39;</span>
        <span class="n">plot_residuals_histogram</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span>
                                 <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">train_metrics</span><span class="p">,</span>
                                 <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;test_residuals_histogram&#39;</span>
        <span class="n">plot_residuals_histogram</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span>  <span class="n">y_test_pred</span><span class="p">,</span>
                                 <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">test_metrics</span><span class="p">,</span>
                                 <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_confusion_matrix"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_confusion_matrix">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Confusion matrix&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to generate a confusion matrix for a classification run. Additional information can be found</span>
<span class="sd">    at: http://scikit-learn.org/stable/auto_examples/model_selection/plot_confusion_matrix.html</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array containing the true y data values</span>

<span class="sd">        y_pred: (numpy array), array containing the predicted y data values</span>

<span class="sd">        savepath: (str), path to save the plotted confusion matrix</span>

<span class="sd">        stats: (dict), dict of training or testing statistics for a particular run</span>

<span class="sd">        normalize: (bool), whether or not to normalize data output as truncated float vs. double</span>

<span class="sd">        title: (str), title of the confusion matrix plot</span>

<span class="sd">        cmap: (matplotlib colormap), the color map to use for confusion matrix plotting</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># calculate confusion matrix and lables in correct order</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="c1">#classes = sorted(list(set(y_true).intersection(set(y_pred))))</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))))</span>

    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="c1">#ax.set_title(title)</span>

    <span class="c1"># create the colorbar, not really needed but everyones got &#39;em</span>
    <span class="n">mappable</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="c1">#fig.colorbar(mappable)</span>

    <span class="c1"># set x and y ticks to labels</span>
    <span class="n">tick_marks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># draw number in the boxes</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fmt</span><span class="p">),</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="c1"># plots the stats</span>
    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True label&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_roc_curve"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_roc_curve">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to calculate and plot the receiver-operator characteristic curve for classification model results</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array of true y data values</span>

<span class="sd">        y_pred: (numpy array), array of predicted y data values</span>

<span class="sd">        savepath: (str), path to save the plotted ROC curve</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#TODO: have work when probability=False in model params. Suggest user set probability=True!!</span>
    <span class="c1">#classes = sorted(list(set(y_true).union(set(y_pred))))</span>
    <span class="c1">#n_classes = y_pred.shape[1]</span>

    <span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span>

    <span class="n">fpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">tpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
        <span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.95</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>
    <span class="c1">#for i in range(len(classes)):</span>
    <span class="c1">#    ax.plot(fpr[i], tpr[i], color=colors[i], lw=2, label=&#39;ROC curve class &#39;+str(i)+&#39; (area = %0.2f)&#39; % roc_auc[i])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ROC curve&#39;</span> <span class="o">+</span> <span class="s1">&#39; (area = </span><span class="si">%0.2f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">roc_auc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Random guess&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="c1">#plot_stats(fig, stats, x_align=0.60, y_align=0.90)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_to_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_precision_recall_curve"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_precision_recall_curve">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_precision_recall_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to calculate and plot the precision-recall curve for classification model results</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array of true y data values</span>

<span class="sd">        y_pred: (numpy array), array of predicted y data values</span>

<span class="sd">        savepath: (str), path to save the plotted precision-recall curve</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Note this only works with probability predictions of the classifier labels.</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span>

    <span class="n">precision</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1">#roc_auc = dict()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
        <span class="n">precision</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">recall</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>

    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.95</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>
    <span class="c1">#for i in range(len(classes)):</span>
    <span class="c1">#    ax.plot(fpr[i], tpr[i], color=colors[i], lw=2, label=&#39;ROC curve class &#39;+str(i)+&#39; (area = %0.2f)&#39; % roc_auc[i])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">recall</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">precision</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Precision-recall curve&#39;</span><span class="p">)</span>
    <span class="c1">#ax.fill_between(recall[1], precision[1], alpha=0.4, color=colors[0])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minn</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="c1">#plot_stats(fig, stats, x_align=0.60, y_align=0.90)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_to_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_residuals_histogram"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_residuals_histogram">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_residuals_histogram</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span>
                             <span class="n">stats</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;residuals histogram&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;residuals&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to calculate and plot the histogram of residuals from regression model</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array of true y data values</span>

<span class="sd">        y_pred: (numpy array), array of predicted y data values</span>

<span class="sd">        savepath: (str), path to save the plotted precision-recall curve</span>

<span class="sd">        stats: (dict), dict of training or testing statistics for a particular run</span>

<span class="sd">        title: (str), title of residuals histogram</span>

<span class="sd">        label: (str), label used for axis labeling</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="c1">#ax.set_title(title)</span>
    <span class="c1"># do the actual plotting</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>

    <span class="c1">#Output residuals data and stats to spreadsheet</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;residual_statistics.csv&#39;</span><span class="p">))</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;residuals.csv&#39;</span><span class="p">)</span>

    <span class="c1">#Get num_bins using smarter method</span>
    <span class="n">num_bins</span> <span class="o">=</span> <span class="n">get_histogram_bins</span><span class="p">(</span><span class="n">y_df</span><span class="o">=</span><span class="n">residuals</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">num_bins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="c1"># normal text stuff</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Value of &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of occurences&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># make y axis ints, because it is discrete</span>
    <span class="c1">#ax.yaxis.set_major_locator(MaxNLocator(integer=True))</span>

    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>
    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.60</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_target_histogram"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_target_histogram">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_target_histogram</span><span class="p">(</span><span class="n">y_df</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;target histogram&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target values&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot the histogram of true y values</span>

<span class="sd">    Args:</span>

<span class="sd">        y_df: (pandas dataframe), dataframe of true y data values</span>

<span class="sd">        savepath: (str), path to save the plotted precision-recall curve</span>

<span class="sd">        title: (str), title of residuals histogram</span>

<span class="sd">        label: (str), label used for axis labeling</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.70</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="c1">#ax.set_title(title)</span>

    <span class="c1">#Get num_bins using smarter method</span>
    <span class="n">num_bins</span> <span class="o">=</span> <span class="n">get_histogram_bins</span><span class="p">(</span><span class="n">y_df</span><span class="o">=</span><span class="n">y_df</span><span class="p">)</span>

    <span class="c1"># do the actual plotting</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_df</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">num_bins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span><span class="c1">#, histtype=&#39;stepfilled&#39;)</span>

    <span class="c1"># normal text stuff</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Value of &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of occurences&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># make y axis ints, because it is discrete</span>
    <span class="c1">#ax.yaxis.set_major_locator(MaxNLocator(integer=True))</span>


    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">y_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()),</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c1"># Save input data stats to csv</span>
    <span class="n">savepath_parse</span> <span class="o">=</span> <span class="n">savepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;target_histogram.png&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath_parse</span><span class="o">+</span><span class="s1">&#39;/&#39;&#39;input_data_statistics.csv&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_predicted_vs_true"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_predicted_vs_true">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_predicted_vs_true</span><span class="p">(</span><span class="n">train_quad</span><span class="p">,</span> <span class="n">test_quad</span><span class="p">,</span> <span class="n">outdir</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to create a parity plot (predicted vs. true values)</span>

<span class="sd">    Args:</span>

<span class="sd">        train_quad: (tuple), tuple containing 4 numpy arrays: true training y data, predicted training y data,</span>

<span class="sd">        training metric data, and groups used in training</span>

<span class="sd">        test_quad: (tuple), tuple containing 4 numpy arrays: true test y data, predicted test y data,</span>

<span class="sd">        testing metric data, and groups used in testing</span>

<span class="sd">        outdir: (str), path to save plots to</span>

<span class="sd">        label: (str), label used for axis labeling</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">train_groups</span> <span class="o">=</span> <span class="n">train_quad</span>
    <span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">test_metrics</span><span class="p">,</span> <span class="n">test_groups</span> <span class="o">=</span> <span class="n">test_quad</span>

    <span class="c1"># make diagonal line from absolute min to absolute max of any data point</span>
    <span class="c1"># using round because Ryan did - but won&#39;t that ruin small numbers??? TODO this</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y_train_pred</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
               <span class="n">y_test_true</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y_test_pred</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">min1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_train_pred</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
               <span class="n">y_test_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test_pred</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span><span class="o">-</span><span class="n">min1</span><span class="p">))</span>
    <span class="n">min1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span><span class="o">-</span><span class="n">min1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">title_addon</span> <span class="ow">in</span> \
            <span class="p">(</span><span class="n">train_quad</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,),</span> <span class="n">test_quad</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,)):</span>

        <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
        <span class="n">x_align</span><span class="o">=</span><span class="mf">0.64</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

        <span class="c1"># set tick labels</span>
        <span class="c1"># notice that we use the same max and min for all three. Don&#39;t</span>
        <span class="c1"># calculate those inside the loop, because all the should be on the same scale and axis</span>
        <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max1</span><span class="p">,</span> <span class="n">min1</span><span class="p">)</span>

        <span class="c1"># plot diagonal line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="p">[</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># do the actual plotting</span>
        <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handles</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">unique_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">train_groups</span><span class="p">,</span> <span class="n">test_groups</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="s1">&#39;unique groups: &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">)))</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">]</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">colorcount</span> <span class="o">=</span> <span class="n">markercount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">groupcount</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_groups</span><span class="p">):</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">groups</span> <span class="o">==</span> <span class="n">group</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{group}</span><span class="s1"> group_percent = {np.count_nonzero(mask) / len(groups)}&#39;</span><span class="p">)</span>
                <span class="n">handles</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_true</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">colorcount</span><span class="p">],</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">markercount</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">colorcount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">colorcount</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">markercount</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">colorcount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">handles</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># set axis labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;predicted_vs_true_&#39;</span><span class="o">+</span> <span class="n">title_addon</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filenames</span></div>

<div class="viewcode-block" id="plot_scatter"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_scatter">[docs]</a><span class="k">def</span> <span class="nf">plot_scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target data&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to create a general scatter plot</span>

<span class="sd">    Args:</span>

<span class="sd">        x: (numpy array), array of x data</span>

<span class="sd">        y: (numpy array), array of y data</span>

<span class="sd">        savepath: (str), path to save plots to</span>

<span class="sd">        groups: (list), list of group labels</span>

<span class="sd">        xlabel: (str), label used for x-axis labeling</span>

<span class="sd">        label: (str), label used for y-axis labeling</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set image aspect ratio:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">()</span>

    <span class="c1"># set tick labels</span>
    <span class="n">max_tick_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">min_tick_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">max_tick_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">min_tick_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">max_tick_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_tick_x</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_tick_x</span><span class="o">-</span><span class="n">min_tick_x</span><span class="p">))</span>
    <span class="n">min_tick_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min_tick_x</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_tick_x</span><span class="o">-</span><span class="n">min_tick_x</span><span class="p">))</span>
    <span class="n">max_tick_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_tick_y</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_tick_y</span><span class="o">-</span><span class="n">min_tick_y</span><span class="p">))</span>
    <span class="n">min_tick_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min_tick_y</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_tick_y</span><span class="o">-</span><span class="n">min_tick_y</span><span class="p">))</span>
    <span class="c1">#divisor_y = get_divisor(max(y), min(y))</span>
    <span class="c1">#max_tick_y = round_up(max(y), divisor_y)</span>
    <span class="c1">#min_tick_y = round_down(min(y), divisor_y)</span>

    <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max_tick_x</span><span class="p">,</span> <span class="n">min_tick_x</span><span class="p">,</span> <span class="n">max_tick_y</span><span class="p">,</span> <span class="n">min_tick_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">]</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="n">colorcount</span> <span class="o">=</span> <span class="n">markercount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">groupcount</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">groups</span><span class="p">)):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">groups</span> <span class="o">==</span> <span class="n">group</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">colorcount</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">markercount</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">colorcount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">colorcount</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">markercount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">colorcount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value of &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_best_worst_split"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_best_worst_split">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_best_worst_split</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">best_run</span><span class="p">,</span> <span class="n">worst_run</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Best Worst Overlay&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target_value&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to create a parity plot (predicted vs. true values) of just the best scoring and worst scoring CV splits</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array of true y data</span>

<span class="sd">        best_run: (dict), the best scoring split_result from mastml_driver</span>

<span class="sd">        worst_run: (dict), the worst scoring split_result from mastml_driver</span>

<span class="sd">        savepath: (str), path to save plots to</span>

<span class="sd">        title: (str), title of the best_worst_split plot</span>

<span class="sd">        label: (str), label used for axis labeling</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="c1"># TODO is round the right thing here?</span>
    <span class="n">minn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">maxx</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">maxx</span><span class="o">-</span><span class="n">minn</span><span class="p">))</span>
    <span class="n">minn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">minn</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">maxx</span><span class="o">-</span><span class="n">minn</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">minn</span><span class="p">,</span> <span class="n">maxx</span><span class="p">],</span> <span class="p">[</span><span class="n">minn</span><span class="p">,</span> <span class="n">maxx</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># set tick labels</span>
    <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span>

    <span class="c1"># do the actual plotting</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">best_run</span><span class="p">[</span><span class="s1">&#39;y_test_true&#39;</span><span class="p">],</span>  <span class="n">best_run</span><span class="p">[</span><span class="s1">&#39;y_test_pred&#39;</span><span class="p">],</span>  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;best test&#39;</span><span class="p">,</span>  <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span>  <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">worst_run</span><span class="p">[</span><span class="s1">&#39;y_test_true&#39;</span><span class="p">],</span> <span class="n">worst_run</span><span class="p">[</span><span class="s1">&#39;y_test_pred&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;worst test&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># set axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1">#font_dict = {&#39;size&#39;   : 10, &#39;family&#39; : &#39;sans-serif&#39;}</span>

    <span class="c1"># Duplicate the stats dicts with an additional label</span>
    <span class="n">best_stats</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;Best Run&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>
    <span class="n">best_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">best_run</span><span class="p">[</span><span class="s1">&#39;test_metrics&#39;</span><span class="p">])</span>
    <span class="n">worst_stats</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;worst Run&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>
    <span class="n">worst_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">worst_run</span><span class="p">[</span><span class="s1">&#39;test_metrics&#39;</span><span class="p">])</span>

    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">best_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>
    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">worst_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.60</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_best_worst_per_point"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_best_worst_per_point">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_best_worst_per_point</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred_list</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">metrics_dict</span><span class="p">,</span>
                              <span class="n">avg_stats</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;best worst per point&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target_value&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to create a parity plot (predicted vs. true values) of the set of best and worst CV scores for each</span>

<span class="sd">    individual data point.</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array of true y data</span>

<span class="sd">        y_pred_list: (list), list of numpy arrays containing predicted y data for each CV split</span>

<span class="sd">        savepath: (str), path to save plots to</span>

<span class="sd">        metrics_dict: (dict), dict of scikit-learn metric objects to calculate score of predicted vs. true values</span>

<span class="sd">        avg_stats: (dict), dict of calculated average metrics over all CV splits</span>

<span class="sd">        title: (str), title of the best_worst_per_point plot</span>

<span class="sd">        label: (str), label used for axis labeling</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">worsts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_y_true</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">yt</span><span class="p">,</span> <span class="n">y_pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="ow">in</span> <span class="n">y_pred_list</span> <span class="ow">or</span> <span class="n">yt</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">worsts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">yp</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yp</span><span class="o">-</span><span class="n">yt</span><span class="p">)))</span>
        <span class="n">bests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">yp</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yp</span><span class="o">-</span><span class="n">yt</span><span class="p">)))</span>
        <span class="n">new_y_true</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>

    <span class="n">worst_stats</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;Worst combined:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>
    <span class="n">best_stats</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;Best combined:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span> <span class="ow">in</span> <span class="n">metrics_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">worst_stats</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">new_y_true</span><span class="p">,</span> <span class="n">worsts</span><span class="p">)</span>
        <span class="n">best_stats</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">new_y_true</span><span class="p">,</span> <span class="n">bests</span><span class="p">)</span>

    <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">15.5</span><span class="o">/</span><span class="mi">24</span> <span class="c1">#mmm yum</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="c1"># gather max and min</span>
    <span class="c1">#all_vals = [val for val in worsts+bests if val is not None]</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">min1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>

    <span class="c1"># draw dashed horizontal line</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="p">[</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># set axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># set tick labels</span>
    <span class="c1">#maxx = max((max(bests), max(worsts), max(new_y_true)))</span>
    <span class="c1">#minn = min((min(bests), min(worsts), min(new_y_true)))</span>
    <span class="c1">#maxx, minn = recursive_max_and_min([bests, worsts, new_y_true])</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span><span class="o">-</span><span class="n">min1</span><span class="p">))</span>
    <span class="n">minn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span><span class="o">-</span><span class="n">min1</span><span class="p">))</span>
    <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">new_y_true</span><span class="p">,</span> <span class="n">bests</span><span class="p">,</span>  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;best test&#39;</span><span class="p">,</span>
               <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span>  <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">new_y_true</span><span class="p">,</span> <span class="n">worsts</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;worst test&#39;</span><span class="p">,</span>
               <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.51</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">worst_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.73</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">best_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_predicted_vs_true_bars"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_predicted_vs_true_bars">[docs]</a><span class="nd">@ipynb_maker</span>
<span class="k">def</span> <span class="nf">plot_predicted_vs_true_bars</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred_list</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span>
                                <span class="n">savepath</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;best worst with bars&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target_value&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to calculate parity plot (predicted vs. true) of average predictions, averaged over all CV splits, with error</span>

<span class="sd">    bars on each point corresponding to the standard deviation of the predicted values over all CV splits.</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array of true y data</span>

<span class="sd">        y_pred_list: (list), list of numpy arrays containing predicted y data for each CV split</span>

<span class="sd">        avg_stats: (dict), dict of calculated average metrics over all CV splits</span>

<span class="sd">        savepath: (str), path to save plots to</span>

<span class="sd">        title: (str), title of the best_worst_per_point plot</span>

<span class="sd">        label: (str), label used for axis labeling</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="n">nice_mean</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span> <span class="k">for</span> <span class="n">y_pred</span> <span class="ow">in</span> <span class="n">y_pred_list</span><span class="p">]</span>
    <span class="n">standard_error_means</span> <span class="o">=</span> <span class="p">[</span><span class="n">nice_std</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">y_pred</span> <span class="ow">in</span> <span class="n">y_pred_list</span><span class="p">]</span>
    <span class="n">standard_errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">nice_std</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span> <span class="k">for</span> <span class="n">y_pred</span> <span class="ow">in</span> <span class="n">y_pred_list</span><span class="p">]</span>
    <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="c1"># gather max and min</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>
    <span class="n">min1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>

    <span class="c1"># draw dashed horizontal line</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="p">[</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># set axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># set tick labels</span>
    <span class="c1">#maxx, minn = recursive_max_and_min([means, y_true])</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">minn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">maxx</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">maxx</span><span class="o">-</span><span class="n">minn</span><span class="p">))</span>
    <span class="n">minn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">minn</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">maxx</span><span class="o">-</span><span class="n">minn</span><span class="p">))</span>
    <span class="c1">#print(maxx, minn, rounder(maxx - minn))</span>
    <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">standard_errors</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_metric_vs_group"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_metric_vs_group">[docs]</a><span class="k">def</span> <span class="nf">plot_metric_vs_group</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">savepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot the value of a particular calculated metric (e.g. RMSE, R^2, etc) for each data group</span>

<span class="sd">    Args:</span>

<span class="sd">        metric: (str), name of a calculation metric</span>

<span class="sd">        groups: (numpy array), array of group names</span>

<span class="sd">        stats: (dict), dict of training or testing statistics for a particular run</span>

<span class="sd">        avg_stats: (dict), dict of calculated average metrics over all CV splits</span>

<span class="sd">        savepath: (str), path to save plots to</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="c1"># do the actual plotting</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span>  <span class="n">stats</span><span class="p">,</span>  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span>  <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># set axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>

    <span class="c1"># Save data stats to csv</span>
    <span class="n">savepath_parse</span> <span class="o">=</span> <span class="n">savepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_vs_group.png&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath_parse</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_vs_group.csv&#39;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_metric_vs_group_size"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_metric_vs_group_size">[docs]</a><span class="k">def</span> <span class="nf">plot_metric_vs_group_size</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">savepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot the value of a particular calculated metric (e.g. RMSE, R^2, etc) as a function of the size of each group.</span>

<span class="sd">    Args:</span>

<span class="sd">        metric: (str), name of a calculation metric</span>

<span class="sd">        groups: (numpy array), array of group names</span>

<span class="sd">        stats: (dict), dict of training or testing statistics for a particular run</span>

<span class="sd">        avg_stats: (dict), dict of calculated average metrics over all CV splits</span>

<span class="sd">        savepath: (str), path to save plots to</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="c1"># Get unique groups from full group array</span>
    <span class="n">unique_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

    <span class="c1"># Get the size of each group</span>
    <span class="n">group_lengths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">unique_groups</span><span class="p">:</span>
        <span class="n">group_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">groups</span><span class="o">==</span><span class="n">group</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>

    <span class="c1"># do the actual plotting</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">group_lengths</span><span class="p">,</span>  <span class="n">stats</span><span class="p">,</span>  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span>  <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># set axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Group size&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="c1">#ax.set_xticklabels(labels=group_lengths, fontsize=14)</span>
    <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>

    <span class="c1"># Save data stats to csv</span>
    <span class="n">savepath_parse</span> <span class="o">=</span> <span class="n">savepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_vs_group_size.png&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">group_lengths</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath_parse</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_vs_group_size.csv&#39;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="prediction_intervals"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.prediction_intervals">[docs]</a><span class="k">def</span> <span class="nf">prediction_intervals</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">68</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to calculate prediction intervals when using Random Forest and Gaussian Process regression models.</span>

<span class="sd">    Prediction intervals for random forest adapted from https://blog.datadive.net/prediction-intervals-for-random-forests/</span>

<span class="sd">    Args:</span>

<span class="sd">        model: (scikit-learn model/estimator object), a scikit-learn model object</span>

<span class="sd">        X: (numpy array), array of X features</span>

<span class="sd">        percentile: (int), percentile for which to form error bars</span>

<span class="sd">    Returns:</span>

<span class="sd">        err_up: (list), list of upper bounds of error bars for each data point</span>

<span class="sd">        err_down: (list), list of lower bounds of error bars for each data point</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">err_down</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">err_up</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">X_aslist</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;RandomForestRegressor&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_aslist</span><span class="p">)):</span>
            <span class="n">preds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">:</span>
                <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_aslist</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">e_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">e_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">e_up</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">e_up</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">e_down</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">e_down</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">10</span>
        <span class="n">err_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_down</span><span class="p">)</span>
        <span class="n">err_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_up</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;GaussianProcessRegressor&#39;</span><span class="p">:</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Get the stdev model error from the predictions of GPR</span>
        <span class="n">err_up</span> <span class="o">=</span> <span class="n">preds</span>
        <span class="n">err_down</span> <span class="o">=</span> <span class="n">preds</span>

    <span class="k">return</span> <span class="n">err_down</span><span class="p">,</span> <span class="n">err_up</span></div>

<div class="viewcode-block" id="plot_normalized_error"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_normalized_error">[docs]</a><span class="k">def</span> <span class="nf">plot_normalized_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">avg_stats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot the normalized residual errors of a model prediction</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array containing the true y data values</span>

<span class="sd">        y_pred: (numpy array), array containing the predicted y data values</span>

<span class="sd">        savepath: (str), path to save the plotted normalized error plot</span>

<span class="sd">        model: (scikit-learn model/estimator object), a scikit-learn model object</span>

<span class="sd">        X: (numpy array), array of X features</span>

<span class="sd">        avg_stats: (dict), dict of calculated average metrics over all CV splits</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
    <span class="c1"># Here: if model is random forest or Gaussian process, get real error bars. Else, just residuals</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="c1"># TODO: also add support for Gradient Boosted Regressor</span>
    <span class="n">models_with_error_predictions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RandomForestRegressor&#39;</span><span class="p">,</span> <span class="s1">&#39;GaussianProcessRegressor&#39;</span><span class="p">]</span>
    <span class="n">has_model_errors</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">models_with_error_predictions</span><span class="p">:</span>
        <span class="n">has_model_errors</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_stats</span><span class="p">:</span>
            <span class="n">err_down</span><span class="p">,</span> <span class="n">err_up</span> <span class="o">=</span> <span class="n">prediction_intervals</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">68</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">avg_stats</span><span class="p">:</span>
        <span class="n">y_pred_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nice_mean</span><span class="p">(</span><span class="n">y_p</span><span class="p">)</span> <span class="k">for</span> <span class="n">y_p</span> <span class="ow">in</span> <span class="n">y_pred</span><span class="p">])</span>
        <span class="n">y_true_</span> <span class="o">=</span> <span class="n">y_true</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_pred_</span> <span class="o">=</span> <span class="n">y_pred</span>
        <span class="n">y_true_</span> <span class="o">=</span> <span class="n">y_true</span>

    <span class="c1">#Need to remove NaN&#39;s before plotting. These will be present when doing validation runs. Note NaN&#39;s only show up in y_pred_</span>
    <span class="n">y_true_</span> <span class="o">=</span> <span class="n">y_true_</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_pred_</span><span class="p">)]</span>
    <span class="n">y_pred_</span> <span class="o">=</span> <span class="n">y_pred_</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_pred_</span><span class="p">)]</span>

    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_true_</span><span class="o">-</span><span class="n">y_pred_</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y_true_</span><span class="o">-</span><span class="n">y_pred_</span><span class="p">)</span>
    <span class="n">density_residuals</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">y_true_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mlab</span><span class="o">.</span><span class="n">normpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analytical Gaussian&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Residuals&quot;</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">minn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">mlab</span><span class="o">.</span><span class="n">normpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)))</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">min</span><span class="p">(</span><span class="n">mlab</span><span class="o">.</span><span class="n">normpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_stats</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_model_errors</span><span class="p">:</span>
            <span class="n">err_avg</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">abs</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">e2</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">err_up</span><span class="p">,</span> <span class="n">err_down</span><span class="p">)]</span>
            <span class="n">model_errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_true_</span><span class="o">-</span><span class="n">y_pred_</span><span class="p">)</span><span class="o">/</span><span class="n">err_avg</span>
            <span class="n">density_errors</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">model_errors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">mlab</span><span class="o">.</span><span class="n">normpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">min</span><span class="p">(</span><span class="n">mlab</span><span class="o">.</span><span class="n">normpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)),</span> <span class="nb">min</span><span class="p">(</span><span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x values&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;analytical gaussian&quot;</span><span class="p">:</span> <span class="n">mlab</span><span class="o">.</span><span class="n">normpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span>
                         <span class="s2">&quot;model residuals&quot;</span><span class="p">:</span> <span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;model errors&quot;</span><span class="p">:</span> <span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x values&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;analytical gaussian&quot;</span><span class="p">:</span> <span class="n">mlab</span><span class="o">.</span><span class="n">normpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span>
                         <span class="s2">&quot;model residuals&quot;</span><span class="p">:</span> <span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">avg_stats</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_model_errors</span><span class="p">:</span>
            <span class="c1"># Need to loop over all splits in directory and import saved model errors from csv files</span>
            <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span>
            <span class="c1"># Remove base directory from list</span>
            <span class="k">del</span> <span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Should only use average errors of test data since predictions are made using test data</span>
            <span class="n">test_err_dfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">test_err_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s1">&#39;test_normalized_error.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;model errors&#39;</span><span class="p">]))</span>

            <span class="c1">###############################</span>
            <span class="c1"># Resize arrays here</span>
            <span class="c1">#TODO: revisit this to make work and clean up</span>

            <span class="n">max_length</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">test_err_dfs</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
                    <span class="n">max_length</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#print(&#39;Max length&#39;)</span>
            <span class="n">test_err_dfs_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">test_err_dfs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_length</span><span class="p">:</span>
                    <span class="n">df_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">max_length</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">test_err_dfs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">test_err_dfs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">test_err_dfs</span> <span class="o">=</span> <span class="n">test_err_dfs_</span>
            <span class="c1">#for df in test_err_dfs:</span>
                <span class="c1">#print(df.shape[0])</span>
            <span class="c1">###############################</span>
            <span class="c1">#test_err_dfs = trim_array(test_err_dfs)</span>

            <span class="c1"># Need to do per-row averaging due to arrays of different lengths (and NaN values)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            def apply_mean(arr):</span>
<span class="sd">                mean_list = list()</span>
<span class="sd">                print(&#39;DOING APPLY MEAN&#39;)</span>
<span class="sd">                length = 0</span>
<span class="sd">                print(&#39;array list size&#39;)</span>
<span class="sd">                print(arr.shape)</span>
<span class="sd">                print(arr[0])</span>
<span class="sd">                for row in arr:</span>
<span class="sd">                    print(row)</span>
<span class="sd">                    if ~np.isnan(row):</span>
<span class="sd">                        length += 1</span>
<span class="sd">                    print(&#39;counting length&#39;)</span>
<span class="sd">                    print(length)</span>
<span class="sd">                    mean_list.append(sum(row)/length)</span>
<span class="sd">                return np.array(mean_list)</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1">#for df in test_err_dfs:</span>
            <span class="c1">#mean_arr = apply_mean(test_err_dfs)</span>
            <span class="c1">#print(&#39;MEAN ARRAY&#39;)</span>
            <span class="c1">#print(mean_arr)</span>
            <span class="c1">#print(mean_arr.shape)</span>
            <span class="c1">#print(test_err_dfs)</span>
            <span class="n">avg_test_model_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">test_err_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1">#print(avg_test_model_errors.shape)</span>
            <span class="c1">#exit()</span>
            <span class="n">x_reduced</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">avg_test_model_errors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#density_errors_average = gaussian_kde(avg_test_model_errors)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_reduced</span><span class="p">,</span> <span class="n">avg_test_model_errors</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
            <span class="c1">#print(x_reduced)</span>
            <span class="c1">#print(avg_test_model_errors)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathrm</span><span class="si">{x}</span><span class="s2">/\mathit{\sigma}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability density&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">miny</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_cumulative_normalized_error"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_cumulative_normalized_error">[docs]</a><span class="k">def</span> <span class="nf">plot_cumulative_normalized_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">avg_stats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot the cumulative normalized residual errors of a model prediction</span>

<span class="sd">    Args:</span>

<span class="sd">        y_true: (numpy array), array containing the true y data values</span>

<span class="sd">        y_pred: (numpy array), array containing the predicted y data values</span>

<span class="sd">        savepath: (str), path to save the plotted cumulative normalized error plot</span>

<span class="sd">        model: (scikit-learn model/estimator object), a scikit-learn model object</span>

<span class="sd">        X: (numpy array), array of X features</span>

<span class="sd">        avg_stats: (dict), dict of calculated average metrics over all CV splits</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
    <span class="c1"># Here: if model is random forest or Gaussian process, get real error bars. Else, just residuals</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="c1"># TODO: also add support for Gradient Boosted Regressor</span>
    <span class="n">models_with_error_predictions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RandomForestRegressor&#39;</span><span class="p">,</span> <span class="s1">&#39;GaussianProcessRegressor&#39;</span><span class="p">]</span>
    <span class="n">has_model_errors</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">models_with_error_predictions</span><span class="p">:</span>
        <span class="n">has_model_errors</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_stats</span><span class="p">:</span>
            <span class="n">err_down</span><span class="p">,</span> <span class="n">err_up</span> <span class="o">=</span> <span class="n">prediction_intervals</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">68</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">avg_stats</span><span class="p">:</span>
        <span class="n">y_pred_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nice_mean</span><span class="p">(</span><span class="n">y_p</span><span class="p">)</span> <span class="k">for</span> <span class="n">y_p</span> <span class="ow">in</span> <span class="n">y_pred</span><span class="p">])</span>
        <span class="n">y_true_</span> <span class="o">=</span> <span class="n">y_true</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_pred_</span> <span class="o">=</span> <span class="n">y_pred</span>
        <span class="n">y_true_</span> <span class="o">=</span> <span class="n">y_true</span>

    <span class="c1">#Need to remove NaN&#39;s before plotting. These will be present when doing validation runs. Note NaN&#39;s only show up in y_pred_</span>
    <span class="n">y_true_</span> <span class="o">=</span> <span class="n">y_true_</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_pred_</span><span class="p">)]</span>
    <span class="n">y_pred_</span> <span class="o">=</span> <span class="n">y_pred_</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_pred_</span><span class="p">)]</span>

    <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

    <span class="n">analytic_gau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="n">analytic_gau</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">)</span>
    <span class="n">n_analytic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">))</span>
    <span class="n">X_analytic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">)</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">y_true_</span><span class="o">-</span><span class="n">y_pred_</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y_true_</span><span class="o">-</span><span class="n">y_pred_</span><span class="p">))</span>
    <span class="n">n_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">))</span>
    <span class="n">X_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="c1">#r&quot;$\mathrm{Predicted \/ Value}, \mathit{eV}$&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathrm</span><span class="si">{x}</span><span class="s2">/\mathit{\sigma}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_residuals</span><span class="p">,</span> <span class="n">n_residuals</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Residuals&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_analytic</span><span class="p">,</span> <span class="n">n_analytic</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analytical Gaussian&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_stats</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_model_errors</span><span class="p">:</span>
            <span class="n">err_avg</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">abs</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">e2</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">err_up</span><span class="p">,</span> <span class="n">err_down</span><span class="p">)]</span>
            <span class="n">model_errors</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">y_true_</span><span class="o">-</span><span class="n">y_pred_</span><span class="p">)</span><span class="o">/</span><span class="n">err_avg</span><span class="p">)</span>
            <span class="c1">#print(&#39;TRUE&#39;)</span>
            <span class="c1">#print(y_true_)</span>
            <span class="c1">#print(&#39;PRED&#39;)</span>
            <span class="c1">#print(y_pred_)</span>
            <span class="c1">#print(&#39;RESIDUAL&#39;)</span>
            <span class="c1">#print(y_pred_-y_true_)</span>
            <span class="c1">#print(&#39;ERRORS FROM MODEL&#39;)</span>
            <span class="c1">#print(err_avg)</span>
            <span class="c1">#print(&#39;ERROR TO PLOT&#39;)</span>
            <span class="c1">#print(model_errors)</span>
            <span class="n">n_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_errors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_errors</span><span class="p">))</span>
            <span class="n">X_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">model_errors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_errors</span><span class="p">,</span> <span class="n">n_errors</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x analytical&quot;</span><span class="p">:</span> <span class="n">X_analytic</span><span class="p">,</span> <span class="s2">&quot;analytical gaussian&quot;</span><span class="p">:</span> <span class="n">n_analytic</span><span class="p">,</span> <span class="s2">&quot;x residuals&quot;</span><span class="p">:</span> <span class="n">X_residuals</span><span class="p">,</span>
                         <span class="s2">&quot;model residuals&quot;</span><span class="p">:</span> <span class="n">n_residuals</span><span class="p">,</span> <span class="s2">&quot;x errors&quot;</span><span class="p">:</span> <span class="n">X_errors</span><span class="p">,</span> <span class="s2">&quot;model errors&quot;</span><span class="p">:</span> <span class="n">err_avg</span><span class="p">}</span>
            <span class="c1"># Save this way to avoid issue with different array sizes in data_dict</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x analytical&quot;</span><span class="p">:</span> <span class="n">X_analytic</span><span class="p">,</span> <span class="s2">&quot;analytical gaussian&quot;</span><span class="p">:</span> <span class="n">n_analytic</span><span class="p">,</span> <span class="s2">&quot;x residuals&quot;</span><span class="p">:</span> <span class="n">X_residuals</span><span class="p">,</span>
                         <span class="s2">&quot;model residuals&quot;</span><span class="p">:</span> <span class="n">n_residuals</span><span class="p">}</span>
            <span class="c1"># Save this way to avoid issue with different array sizes in data_dict</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">avg_stats</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_model_errors</span><span class="p">:</span>
            <span class="c1"># Need to loop over all splits in directory and import saved model errors from csv files</span>
            <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span>
            <span class="c1"># Remove base directory from list</span>
            <span class="k">del</span> <span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Should only use average errors of test data since predictions are made using test data</span>
            <span class="n">test_err_dfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">X_errors_dfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">test_err_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s1">&#39;test_cumulative_normalized_error.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;model errors&#39;</span><span class="p">]))</span>
                <span class="n">X_errors_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s1">&#39;test_cumulative_normalized_error.csv&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;x errors&#39;</span><span class="p">]))</span>

            <span class="c1">###############################</span>
            <span class="c1"># Resize arrays here</span>
            <span class="c1"># TODO: revisit this to make work and clean up</span>
            <span class="n">max_length</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">test_err_dfs</span><span class="p">:</span>
                <span class="c1">#print(df.shape[0])</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
                    <span class="n">max_length</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#print(&#39;Max length&#39;)</span>
            <span class="n">test_err_dfs_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">test_err_dfs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_length</span><span class="p">:</span>
                    <span class="n">df_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">test_err_dfs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">test_err_dfs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">test_err_dfs</span> <span class="o">=</span> <span class="n">test_err_dfs_</span>
            <span class="c1">#for df in test_err_dfs:</span>
                <span class="c1">#print(df.shape[0])</span>
            <span class="c1">###############################</span>
            <span class="c1">###############################</span>
            <span class="c1"># Resize arrays here</span>

            <span class="c1">#max_length = 0</span>
            <span class="c1">#for df in X_errors_dfs:</span>
            <span class="c1">#    print(df.shape[0])</span>
            <span class="c1">#    if df.shape[0] &gt; max_length:</span>
            <span class="c1">#        max_length = df.shape[0]</span>
            <span class="c1">#print(&#39;Max length&#39;)</span>
            <span class="c1">#X_errors_dfs_ = list()</span>
            <span class="c1">#for df in X_errors_dfs:</span>
            <span class="c1">#    if df.shape[0] &lt; max_length:</span>
            <span class="c1">#        df_ = np.append(df, np.repeat(np.nan, max_length - df.shape[0]))</span>
            <span class="c1">#        X_errors_dfs_.append(df_)</span>
            <span class="c1">#    else:</span>
            <span class="c1">#        X_errors_dfs_.append(df)</span>
            <span class="c1">#X_errors_dfs = X_errors_dfs_</span>
            <span class="c1">#for df in X_errors_dfs:</span>
            <span class="c1">#    print(df.shape[0])</span>
            <span class="c1">###############################</span>
            <span class="c1">#test_err_dfs = trim_array(test_err_dfs)</span>
            <span class="c1">#X_errors_dfs = trim_array(X_errors_dfs)</span>
            <span class="n">avg_test_model_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">test_err_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">n_errors_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">avg_test_model_errors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">avg_test_model_errors</span><span class="p">))</span>
            <span class="c1">#avg_X_errors = np.nanmean(X_errors_dfs, axis=0)</span>
            <span class="n">avg_X_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">avg_test_model_errors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">avg_X_errors</span><span class="p">,</span> <span class="n">n_errors_avg</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">xlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">ylabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">axin</span> <span class="o">=</span> <span class="n">zoomed_inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">axin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_residuals</span><span class="p">,</span> <span class="n">n_residuals</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Residuals&quot;</span><span class="p">)</span>
    <span class="n">axin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_analytic</span><span class="p">,</span> <span class="n">n_analytic</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analytical Gaussian&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">has_model_errors</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_stats</span><span class="p">:</span>
            <span class="n">axin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_errors</span><span class="p">,</span> <span class="n">n_errors</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">avg_stats</span><span class="p">:</span>
            <span class="n">axin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">avg_X_errors</span><span class="p">,</span> <span class="n">avg_test_model_errors</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
    <span class="n">axin</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xlabels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">axin</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">axin</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">axin</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">maxx</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">minn</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">miny</span><span class="p">)</span>

    <span class="n">mark_inset</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">axin</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_1d_heatmap"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_1d_heatmap">[docs]</a><span class="k">def</span> <span class="nf">plot_1d_heatmap</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">heats</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">heatlabel</span><span class="o">=</span><span class="s1">&#39;heats&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot a heatmap for values of a single variable; used for plotting GridSearch results in hyperparameter optimization.</span>

<span class="sd">    Args:</span>

<span class="sd">        xs: (numpy array), array of first variable values to plot heatmap against</span>

<span class="sd">        heats: (numpy array), array of heat values to plot</span>

<span class="sd">        savepath: (str), path to save the 1D heatmap to</span>

<span class="sd">        xlabel: (str), the x-axis label</span>

<span class="sd">        heatlabel: (str), the heat value axis label</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#TODO have more general solution</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">heats</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">heatlabel</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="c1"># Escape from error of passing tuples when optimizing neural net</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="plot_2d_heatmap"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_2d_heatmap">[docs]</a><span class="k">def</span> <span class="nf">plot_2d_heatmap</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">heats</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">heatlabel</span><span class="o">=</span><span class="s1">&#39;heat&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot a heatmap for values of two variables; used for plotting GridSearch results in hyperparameter optimization.</span>

<span class="sd">    Args:</span>

<span class="sd">        xs: (numpy array), array of first variable values to plot heatmap against</span>

<span class="sd">        ys: (numpy array), array of second variable values to plot heatmap against</span>

<span class="sd">        heats: (numpy array), array of heat values to plot</span>

<span class="sd">        savepath: (str), path to save the 2D heatmap to</span>

<span class="sd">        xlabel: (str), the x-axis label</span>

<span class="sd">        ylabel: (str), the y-axis label</span>

<span class="sd">        heatlabel: (str), the heat value axis label</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO have more general solution</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">()</span>
        <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">heats</span><span class="p">)</span> <span class="c1"># marker=&#39;o&#39;, lw=0, s=20, cmap=cm.plasma</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">heatlabel</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="c1"># Escape from error of passing tuples when optimizing neural net</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="plot_3d_heatmap"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_3d_heatmap">[docs]</a><span class="k">def</span> <span class="nf">plot_3d_heatmap</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">heats</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">heatlabel</span><span class="o">=</span><span class="s1">&#39;heat&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to plot a heatmap for values of three variables; used for plotting GridSearch results in hyperparameter optimization.</span>

<span class="sd">    Args:</span>

<span class="sd">        xs: (numpy array), array of first variable values to plot heatmap against</span>

<span class="sd">        ys: (numpy array), array of second variable values to plot heatmap against</span>

<span class="sd">        zs: (numpy array), array of third variable values to plot heatmap against</span>

<span class="sd">        heats: (numpy array), array of heat values to plot</span>

<span class="sd">        savepath: (str), path to save the 2D heatmap to</span>

<span class="sd">        xlabel: (str), the x-axis label</span>

<span class="sd">        ylabel: (str), the y-axis label</span>

<span class="sd">        zlabel: (str), the z-axis label</span>

<span class="sd">        heatlabel: (str), the heat value axis label</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Escape from error of passing tuples when optimzing neural net</span>
    <span class="c1"># TODO have more general solution</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># this import has side effects, needed for 3d plots:</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
        <span class="c1"># Set image aspect ratio:</span>
        <span class="c1"># (eeds to be wide enough or plot will shrink really skinny)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
        <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span> <span class="c1"># modifies fig in place</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">heats</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">zlabel</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">heatlabel</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">fig</span><span class="p">]</span>
    <span class="n">anim</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#anim.save(savepath+&#39;.mp4&#39;, fps=5, extra_args=[&#39;-vcodec&#39;, &#39;libx264&#39;])</span>
    <span class="n">anim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">savepath</span><span class="o">+</span><span class="s1">&#39;.gif&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;imagemagick&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_learning_curve"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_learning_curve">[docs]</a><span class="k">def</span> <span class="nf">plot_learning_curve</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_mean</span><span class="p">,</span> <span class="n">test_mean</span><span class="p">,</span> <span class="n">train_stdev</span><span class="p">,</span> <span class="n">test_stdev</span><span class="p">,</span> <span class="n">score_name</span><span class="p">,</span> <span class="n">learning_curve_type</span><span class="p">,</span> <span class="n">savepath</span><span class="o">=</span><span class="s1">&#39;data_learning_curve&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to plot both data and feature learning curves</span>

<span class="sd">    Args:</span>

<span class="sd">        train_sizes: (numpy array), array of x-axis values, such as fraction of data used or number of features</span>

<span class="sd">        train_mean: (numpy array), array of training data mean values, averaged over some type/number of CV splits</span>

<span class="sd">        test_mean: (numpy array), array of test data mean values, averaged over some type/number of CV splits</span>

<span class="sd">        train_stdev: (numpy array), array of training data standard deviation values, from some type/number of CV splits</span>

<span class="sd">        test_stdev: (numpy array), array of test data standard deviation values, from some type/number of CV splits</span>

<span class="sd">        score_name: (str), type of score metric for learning curve plotting; used in y-axis label</span>

<span class="sd">        learning_curve_type: (str), type of learning curve employed: &#39;sample_learning_curve&#39; or &#39;feature_learning_curve&#39;</span>

<span class="sd">        savepath: (str), path to save the plotted learning curve to</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set image aspect ratio (do custom for learning curve):</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
    <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:])</span>

    <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">)</span>
    <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">)</span>

    <span class="n">max_y</span><span class="p">,</span> <span class="n">min_y</span> <span class="o">=</span> <span class="n">recursive_max_and_min</span><span class="p">([</span>
        <span class="n">train_mean</span><span class="p">,</span>
        <span class="n">train_mean</span> <span class="o">+</span> <span class="n">train_stdev</span><span class="p">,</span>
        <span class="n">train_mean</span> <span class="o">-</span> <span class="n">train_stdev</span><span class="p">,</span>
        <span class="n">test_mean</span><span class="p">,</span>
        <span class="n">test_mean</span> <span class="o">+</span> <span class="n">test_stdev</span><span class="p">,</span>
        <span class="n">test_mean</span> <span class="o">-</span> <span class="n">test_stdev</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="n">max_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_x</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span><span class="p">))</span>
    <span class="n">min_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min_x</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span><span class="p">))</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_y</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_y</span><span class="o">-</span><span class="n">min_y</span><span class="p">))</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min_y</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_y</span><span class="o">-</span><span class="n">min_y</span><span class="p">))</span>
    <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">min_y</span><span class="p">)</span>

    <span class="c1"># plot and collect handles h1 and h2 for making legend</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_mean</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_mean</span><span class="o">-</span><span class="n">train_stdev</span><span class="p">,</span> <span class="n">train_mean</span><span class="o">+</span><span class="n">train_stdev</span><span class="p">,</span>
                     <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_mean</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_mean</span><span class="o">-</span><span class="n">test_stdev</span><span class="p">,</span> <span class="n">test_mean</span><span class="o">+</span><span class="n">test_stdev</span><span class="p">,</span>
                     <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;train score&#39;</span><span class="p">,</span> <span class="s1">&#39;test score&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">learning_curve_type</span> <span class="o">==</span> <span class="s1">&#39;sample_learning_curve&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of training data points&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">learning_curve_type</span> <span class="o">==</span> <span class="s1">&#39;feature_learning_curve&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of features selected&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The param &quot;learning_curve_type&quot; must be either &quot;sample_learning_curve&quot; or &quot;feature_learning_curve&quot;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">score_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="c1"># Save output data to spreadsheet</span>
    <span class="n">df_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_mean</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_stdev</span><span class="p">),</span>
                           <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_mean</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_stdev</span><span class="p">)],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df_concat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;train_sizes&#39;</span><span class="p">,</span> <span class="s1">&#39;train_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;train_stdev&#39;</span><span class="p">,</span> <span class="s1">&#39;test_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;test_stdev&#39;</span><span class="p">]</span>
    <span class="n">df_concat</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
    <span class="n">plot_learning_curve_convergence</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_mean</span><span class="p">,</span> <span class="n">score_name</span><span class="p">,</span> <span class="n">learning_curve_type</span><span class="p">,</span> <span class="n">savepath</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot_learning_curve_convergence"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_learning_curve_convergence">[docs]</a><span class="k">def</span> <span class="nf">plot_learning_curve_convergence</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_mean</span><span class="p">,</span> <span class="n">score_name</span><span class="p">,</span> <span class="n">learning_curve_type</span><span class="p">,</span> <span class="n">savepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to plot both the convergence of data and feature learning curves as a function of amount of data or features</span>

<span class="sd">    used, respectively.</span>

<span class="sd">    Args:</span>

<span class="sd">        train_sizes: (numpy array), array of x-axis values, such as fraction of data used or number of features</span>

<span class="sd">        test_mean: (numpy array), array of test data mean values, averaged over some type/number of CV splits</span>

<span class="sd">        score_name: (str), type of score metric for learning curve plotting; used in y-axis label</span>

<span class="sd">        learning_curve_type: (str), type of learning curve employed: &#39;sample_learning_curve&#39; or &#39;feature_learning_curve&#39;</span>

<span class="sd">        savepath: (str), path to save the plotted convergence learning curve to</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Function to examine the minimization of error in learning curve CV scores as function of amount of data or number</span>
    <span class="c1"># of features used.</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">))]</span>
    <span class="n">test_mean</span> <span class="o">=</span> <span class="n">test_mean</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">slopes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_mean</span><span class="p">))):</span>
        <span class="k">if</span> <span class="n">step</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">slopes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">test_mean</span><span class="p">[</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_mean</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span><span class="p">[</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">steps</span><span class="p">[</span><span class="n">step</span><span class="p">]))</span>

    <span class="c1"># Remove first entry to steps for plotting</span>
    <span class="k">del</span> <span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Get moving average of slopes to generate smoother curve</span>
    <span class="n">window_size</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_mean</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">steps_moving_average</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">slopes_moving_average</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1">#### Plotting</span>
    <span class="c1"># Set image aspect ratio (do custom for learning curve):</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
    <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:])</span>

    <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
    <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span>
    <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">min_y</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">slopes</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">steps_moving_average</span><span class="p">,</span> <span class="n">slopes_moving_average</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;score slope&#39;</span><span class="p">,</span> <span class="s1">&#39;smoothed score slope&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Learning curve step&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Change in &#39;</span><span class="o">+</span><span class="n">score_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="o">+</span><span class="s1">&#39;_convergence&#39;</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">learning_curve_type</span> <span class="o">==</span> <span class="s1">&#39;feature_learning_curve&#39;</span><span class="p">:</span>
        <span class="c1"># First, set number optimal features to all features in case stopping criteria not met</span>
        <span class="n">n_features_optimal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_mean</span><span class="p">)</span>
        <span class="c1"># Determine what the optimal number of features are to use</span>
        <span class="c1"># TODO: have user set stopping criteria. Have default by 0.005 (0.5%)</span>
        <span class="n">stopping_criteria</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="n">slopes_moving_average_list</span> <span class="o">=</span> <span class="n">slopes_moving_average</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slope</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slopes_moving_average_list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">slopes_moving_average_list</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">slopes_moving_average_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">slopes_moving_average_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="n">stopping_criteria</span><span class="p">:</span>
                    <span class="n">n_features_optimal</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Write optimal number of features to text file</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="o">+</span><span class="s1">&#39;_optimalfeaturenumber.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n_features_optimal</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<span class="c1">### Helpers:</span>

<div class="viewcode-block" id="trim_array"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.trim_array">[docs]</a><span class="k">def</span> <span class="nf">trim_array</span><span class="p">(</span><span class="n">arr_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to trim a set of arrays to make all arrays the same shape</span>

<span class="sd">    Args:</span>

<span class="sd">        arr_list: (list), list of numpy arrays, where arrays are different sizes</span>

<span class="sd">    Returns:</span>

<span class="sd">        arr_list: (), list of trimmed numpy arrays, where arrays are same size</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: a better way to handle arrays with very different shapes? Otherwise average only uses # of points of smallest array</span>
    <span class="c1"># Need to make arrays all same shapes if they aren&#39;t</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arr_list</span><span class="p">]</span>
    <span class="n">size_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
    <span class="n">arr_list_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">size_min</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">size_min</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">arr_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">arr_list</span> <span class="o">=</span> <span class="n">arr_list_</span>
    <span class="k">return</span> <span class="n">arr_list</span></div>

<div class="viewcode-block" id="rounder"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.rounder">[docs]</a><span class="k">def</span> <span class="nf">rounder</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to obtain number of decimal places to report on plots</span>

<span class="sd">    Args:</span>

<span class="sd">        delta: (float), a float representing the change in two y values on a plot, used to obtain the plot axis spacing size</span>

<span class="sd">    Return:</span>

<span class="sd">        (int), an integer denoting the number of decimal places to use</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="mf">0.001</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="mf">0.01</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="mf">0.1</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="get_histogram_bins"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.get_histogram_bins">[docs]</a><span class="k">def</span> <span class="nf">get_histogram_bins</span><span class="p">(</span><span class="n">y_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to obtain the number of bins to use when plotting a histogram</span>

<span class="sd">    Args:</span>

<span class="sd">        y_df: (pandas Series or numpy array), array of y data used to construct histogram</span>

<span class="sd">    Returns:</span>

<span class="sd">        num_bins: (int), the number of bins to use when plotting a histogram</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bin_dividers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">y_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">bin_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">divider</span> <span class="ow">in</span> <span class="n">bin_dividers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">divider</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">y_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">divider</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bins</span> <span class="o">&lt;</span> <span class="n">y_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">bin_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">num_bins</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_bins</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bin_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_bins</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">return</span> <span class="n">num_bins</span></div>

<div class="viewcode-block" id="stat_to_string"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.stat_to_string">[docs]</a><span class="k">def</span> <span class="nf">stat_to_string</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that converts a metric object into a string for displaying on a plot</span>

<span class="sd">    Args:</span>

<span class="sd">        name: (str), long name of a stat metric or quantity</span>

<span class="sd">        value: (float), value of the metric or quantity</span>

<span class="sd">    Return:</span>

<span class="sd">        (str), a string of the metric name, adjusted to look nicer for inclusion on a plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="s2">&quot; Stringifies the name value pair for display within a plot &quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">nice_names</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">nice_names</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="c1"># has a name only</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">name</span>
    <span class="c1"># has a mean and std</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{mean:.3f}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\pm$&#39;</span> <span class="o">+</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{std:.3f}</span><span class="s1">&#39;</span>
    <span class="c1"># has a name and value only</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">%</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">: {int(value)}&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">: </span><span class="si">{value:.3f}</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">: </span><span class="si">{value}</span><span class="s1">&#39;</span> <span class="c1"># probably a string</span></div>

<div class="viewcode-block" id="plot_stats"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.plot_stats">[docs]</a><span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">font_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that prints stats onto the plot. Goes off screen if they are too long or too many in number.</span>

<span class="sd">    Args:</span>

<span class="sd">        fig: (matplotlib figure object), a matplotlib figure object</span>

<span class="sd">        stats: (dict), dict of statistics to be included with a plot</span>

<span class="sd">        x_align: (float), float denoting x position of where to align display of stats on a plot</span>

<span class="sd">        y_align: (float), float denoting y position of where to align display of stats on a plot</span>

<span class="sd">        font_dict: (dict), dict of matplotlib font options to alter display of stats on plot</span>

<span class="sd">        fontsize: (int), the fontsize of stats to display on plot</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stat_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stat_to_string</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="p">,</span> <span class="n">stat_str</span><span class="p">,</span>
             <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_dict</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span></div>

<div class="viewcode-block" id="make_fig_ax"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.make_fig_ax">[docs]</a><span class="k">def</span> <span class="nf">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to make matplotlib figure and axes objects. Using Object Oriented interface from https://matplotlib.org/gallery/api/agg_oo_sgskip.html</span>

<span class="sd">    Args:</span>

<span class="sd">        aspect_ratio: (float), aspect ratio for figure and axes creation</span>

<span class="sd">        x_align: (float), x position to draw edge of figure. Needed so can display stats alongside plot</span>

<span class="sd">        left: (float), the leftmost position to draw edge of figure</span>

<span class="sd">    Returns:</span>

<span class="sd">        fig: (matplotlib fig object), a matplotlib figure object with the specified aspect ratio</span>

<span class="sd">        ax: (matplotlib ax object), a matplotlib axes object with the specified aspect ratio</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set image aspect ratio:</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
    <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># Set custom positioning, see this guide for more details:</span>
    <span class="c1"># https://python4astronomers.github.io/plotting/advanced.html</span>
    <span class="c1">#left   = 0.10</span>
    <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">right</span>  <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">top</span>    <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">x_align</span> <span class="o">-</span> <span class="n">left</span> <span class="o">-</span> <span class="n">right</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="make_fig_ax_square"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.make_fig_ax_square">[docs]</a><span class="k">def</span> <span class="nf">make_fig_ax_square</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to make square shaped matplotlib figure and axes objects. Using Object Oriented interface from</span>

<span class="sd">    https://matplotlib.org/gallery/api/agg_oo_sgskip.html</span>

<span class="sd">    Args:</span>

<span class="sd">        aspect: (str), &#39;equal&#39; denotes x and y aspect will be equal (i.e. square)</span>

<span class="sd">        aspect_ratio: (float), aspect ratio for figure and axes creation</span>

<span class="sd">    Returns:</span>

<span class="sd">        fig: (matplotlib fig object), a matplotlib figure object with the specified aspect ratio</span>

<span class="sd">        ax: (matplotlib ax object), a matplotlib axes object with the specified aspect ratio</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set image aspect ratio:</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
    <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="make_axis_same"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.make_axis_same">[docs]</a><span class="k">def</span> <span class="nf">make_axis_same</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max1</span><span class="p">,</span> <span class="n">min1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to make the x and y ticks for each axis the same. Useful for parity plots</span>

<span class="sd">    Args:</span>

<span class="sd">        ax: (matplotlib axis object), a matplotlib axes object</span>

<span class="sd">        max1: (float), the maximum value of a particular axis</span>

<span class="sd">        min1: (float), the minimum value of a particular axis</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max1</span> <span class="o">-</span> <span class="n">min1</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">max1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">min1</span><span class="p">))</span> <span class="o">//</span> <span class="mi">3</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">min1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max1</span><span class="p">)</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span></div>

<div class="viewcode-block" id="nice_mean"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.nice_mean">[docs]</a><span class="k">def</span> <span class="nf">nice_mean</span><span class="p">(</span><span class="n">ls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return mean of a list or equivalent array with NaN values</span>

<span class="sd">    Args:</span>

<span class="sd">        ls: (list), list of values</span>

<span class="sd">    Returns:</span>

<span class="sd">        (numpy array), array containing mean of list of values or NaN if list has no values</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>

<div class="viewcode-block" id="nice_std"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.nice_std">[docs]</a><span class="k">def</span> <span class="nf">nice_std</span><span class="p">(</span><span class="n">ls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return standard deviation of a list or equivalent array with NaN values</span>

<span class="sd">    Args:</span>

<span class="sd">        ls: (list), list of values</span>

<span class="sd">    Returns:</span>

<span class="sd">        (numpy array), array containing standard deviation of list of values or NaN if list has no values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>

<div class="viewcode-block" id="round_down"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.round_down">[docs]</a><span class="k">def</span> <span class="nf">round_down</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return a rounded down number</span>

<span class="sd">    Args:</span>

<span class="sd">        num: (float), a number to round down</span>

<span class="sd">        divisor: (int), divisor to denote how to round down</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), the rounded-down number</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">num</span> <span class="o">-</span> <span class="p">(</span><span class="n">num</span><span class="o">%</span><span class="n">divisor</span><span class="p">)</span></div>

<div class="viewcode-block" id="round_up"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.round_up">[docs]</a><span class="k">def</span> <span class="nf">round_up</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return a rounded up number</span>

<span class="sd">    Args:</span>

<span class="sd">        num: (float), a number to round up</span>

<span class="sd">        divisor: (int), divisor to denote how to round up</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), the rounded-up number</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">))</span> <span class="o">*</span> <span class="n">divisor</span></div>

<div class="viewcode-block" id="get_divisor"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.get_divisor">[docs]</a><span class="k">def</span> <span class="nf">get_divisor</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to obtain a sensible divisor based on range of two values</span>

<span class="sd">    Args:</span>

<span class="sd">        high: (float), a max data value</span>

<span class="sd">        low: (float), a min data value</span>

<span class="sd">    Returns:</span>

<span class="sd">        divisor: (float), a number used to make sensible axis ticks</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">high</span><span class="o">-</span><span class="n">low</span>
    <span class="n">divisor</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="n">divisor</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">divisor</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">divisor</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">divisor</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
                        <span class="n">divisor</span> <span class="o">=</span> <span class="mf">0.001</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">divisor</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="k">return</span> <span class="n">divisor</span></div>

<div class="viewcode-block" id="recursive_max"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.recursive_max">[docs]</a><span class="k">def</span> <span class="nf">recursive_max</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to recursively find the max value of an array of iterables.</span>

<span class="sd">    Credit: https://www.linkedin.com/pulse/ask-recursion-during-coding-interviews-identify-good-talent-veteanu/</span>

<span class="sd">    Args:</span>

<span class="sd">        arr: (numpy array), an array of values or iterables</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), max value in arr</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
        <span class="n">recursive_max</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">arr</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="recursive_min"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.recursive_min">[docs]</a><span class="k">def</span> <span class="nf">recursive_min</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to recursively find the min value of an array of iterables.</span>

<span class="sd">    Credit: https://www.linkedin.com/pulse/ask-recursion-during-coding-interviews-identify-good-talent-veteanu/</span>

<span class="sd">    Args:</span>

<span class="sd">        arr: (numpy array), an array of values or iterables</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), min value in arr</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">recursive_min</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">arr</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="recursive_max_and_min"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper.recursive_max_and_min">[docs]</a><span class="k">def</span> <span class="nf">recursive_max_and_min</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to recursively return max and min of values or iterables in array</span>

<span class="sd">    Args:</span>

<span class="sd">        arr: (numpy array), an array of values or iterables</span>

<span class="sd">    Returns:</span>

<span class="sd">        (tuple), tuple containing max and min of arr</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">recursive_max</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">recursive_min</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></div>

<div class="viewcode-block" id="_set_tick_labels"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper._set_tick_labels">[docs]</a><span class="k">def</span> <span class="nf">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that sets the x and y ticks to be in the same range</span>

<span class="sd">    Args:</span>

<span class="sd">        ax: (matplotlib axes object), a matplotlib axes object</span>

<span class="sd">        maxx: (float), a maximum value</span>

<span class="sd">        minn: (float), a minimum value</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span> <span class="c1"># I love it when this happens</span></div>

<div class="viewcode-block" id="_set_tick_labels_different"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper._set_tick_labels_different">[docs]</a><span class="k">def</span> <span class="nf">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max_tick_x</span><span class="p">,</span> <span class="n">min_tick_x</span><span class="p">,</span> <span class="n">max_tick_y</span><span class="p">,</span> <span class="n">min_tick_y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that sets the x and y ticks, when the axes have different ranges</span>

<span class="sd">    Args:</span>

<span class="sd">        ax: (matplotlib axes object), a matplotlib axes object</span>

<span class="sd">        max_tick_x: (float), the maximum tick value for the x axis</span>

<span class="sd">        min_tick_x: (float), the minimum tick value for the x axis</span>

<span class="sd">        max_tick_y: (float), the maximum tick value for the y axis</span>

<span class="sd">        min_tick_y: (float), the minimum tick value for the y axis</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tickvals_x</span> <span class="o">=</span> <span class="n">nice_range</span><span class="p">(</span><span class="n">min_tick_x</span><span class="p">,</span> <span class="n">max_tick_x</span><span class="p">)</span>
    <span class="n">tickvals_y</span> <span class="o">=</span> <span class="n">nice_range</span><span class="p">(</span><span class="n">min_tick_y</span><span class="p">,</span> <span class="n">max_tick_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tickvals_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tickvals_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_x</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_x</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">tickvals_x</span> <span class="o">=</span> <span class="n">tickvals_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tickvals_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_y</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tickvals_y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_y</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_y</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">tickvals_y</span> <span class="o">=</span> <span class="n">tickvals_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#tickvals_x = _clean_tick_labels(tickvals=tickvals_x, delta=max_tick_x-min_tick_x)</span>
    <span class="c1">#tickvals_y = _clean_tick_labels(tickvals=tickvals_y, delta=max_tick_y - min_tick_y)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">tickvals_x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">tickvals_y</span><span class="p">)</span>

    <span class="n">ticklabels_x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">tickvals_x</span><span class="p">]</span>
    <span class="n">ticklabels_y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">tickvals_y</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">ticklabels_x</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">ticklabels_y</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span></div>

<div class="viewcode-block" id="_clean_tick_labels"><a class="viewcode-back" href="../12_plot_helper.html#plot_helper._clean_tick_labels">[docs]</a><span class="k">def</span> <span class="nf">_clean_tick_labels</span><span class="p">(</span><span class="n">tickvals</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to attempt to clean up axis tick values so they don&#39;t overlap from being too dense</span>

<span class="sd">    Args:</span>

<span class="sd">        tickvals: (list), a list containing the initial axis tick values</span>

<span class="sd">        delta: (float), number representing the numerical difference of two ticks</span>

<span class="sd">    Returns:</span>

<span class="sd">        tickvals_clean: (list), a list containing the updated axis tick values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tickvals_clean</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tickvals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tickvals</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tickvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="n">tickvals_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tickvals_clean</span> <span class="o">=</span> <span class="n">tickvals</span>
    <span class="k">return</span> <span class="n">tickvals_clean</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, University of Wisconsin-Madison Computational Materials Group.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>