

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mastml.plots &mdash; MAterials Simulation Toolkit for Machine Learning (MAST-ML) 2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> MAterials Simulation Toolkit for Machine Learning (MAST-ML)
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../00_acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../0_4_majorchanges.html">MAST-ML version 3.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../0_4_majorchanges.html#new-changes-to-mast-ml">New changes to MAST-ML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../0_installation.html">Installing MAST-ML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../0_1_hardware_data_requirements.html">Hardware and Data Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../0_1_hardware_data_requirements.html#hardware">Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../0_1_hardware_data_requirements.html#data">Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../0_1_terminal_installation.html">Terminal installation (Linux or linux-like terminal environment e.g. Mac)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../0_1_terminal_installation.html#install-python3">Install Python3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../0_1_terminal_installation.html#create-a-conda-environment-if-using-anaconda">Create a conda environment (if using Anaconda)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../0_1_terminal_installation.html#create-a-virtualenv-environment-if-not-using-anaconda">Create a virtualenv environment (if not using Anaconda)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../0_1_terminal_installation.html#install-the-mast-ml-package-via-pypi">Install the MAST-ML package via PyPi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../0_1_terminal_installation.html#install-the-mast-ml-package-via-git">Install the MAST-ML package via Git</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../0_1_terminal_installation.html#set-up-juptyer-notebooks">Set up Juptyer notebooks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../0_1_terminal_installation.html#imports-that-dont-work">Imports that don’t work</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../0_2_windows_installation.html">Windows installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../0_2_windows_installation.html#install-python3">Install Python3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../0_2_windows_installation.html#create-a-conda-environment">Create a conda environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../0_2_windows_installation.html#set-up-the-spyder-ide-and-jupyter-notebooks">Set up the Spyder IDE and Jupyter notebooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../0_2_windows_installation.html#install-the-mast-ml-package">Install the MAST-ML package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../0_2_windows_installation.html#imports-that-dont-work">Imports that don’t work</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../0_2_windows_installation.html#windows-10-install-step-by-step-guide-credit-joe-kern">Windows 10 install: step-by-step guide (credit Joe Kern)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../0_3_startup.html">Getting Started with MAST-ML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../0_3_startup.html#installing-mast-ml">Installing MAST-ML</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../0_3_startup.html#performing-your-first-mast-ml-run">Performing your first MAST-ML run</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../0_5_tutorials.html">Overview of MAST-ML tutorials and examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../0_5_tutorials.html#mast-ml-tutorials">MAST-ML tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../1_data_cleaning.html">Code Documentation: Data Cleaning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../1_data_cleaning.html#module-mastml.data_cleaning">mastml.data_cleaning Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../1_data_cleaning.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_cleaning.DataCleaning.html">DataCleaning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_cleaning.DataUtilities.html">DataUtilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_cleaning.PPCA.html">PPCA</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../1_data_cleaning.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2_data_splitters.html">Code Documentation: Data Splitters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2_data_splitters.html#module-mastml.data_splitters">mastml.data_splitters Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../2_data_splitters.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.BaseSplitter.html">BaseSplitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.Bootstrap.html">Bootstrap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.JustEachGroup.html">JustEachGroup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.LeaveCloseCompositionsOut.html">LeaveCloseCompositionsOut</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.LeaveOutPercent.html">LeaveOutPercent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.LeaveOutTwinCV.html">LeaveOutTwinCV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.NoSplit.html">NoSplit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.data_splitters.SklearnDataSplitter.html">SklearnDataSplitter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../2_data_splitters.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../3_datasets.html">Code Documentation: Datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../3_datasets.html#module-mastml.datasets">mastml.datasets Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../3_datasets.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.datasets.FigshareDatasets.html">FigshareDatasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.datasets.FoundryDatasets.html">FoundryDatasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.datasets.LocalDatasets.html">LocalDatasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.datasets.MatminerDatasets.html">MatminerDatasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.datasets.SklearnDatasets.html">SklearnDatasets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../3_datasets.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../4_error_analysis.html">Code Documentation: Error Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_error_analysis.html#module-mastml.error_analysis">mastml.error_analysis Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../4_error_analysis.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.error_analysis.CorrectionFactors.html">CorrectionFactors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.error_analysis.ErrorUtils.html">ErrorUtils</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../4_error_analysis.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../5_feature_generators.html">Code Documentation: Feature Generators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../5_feature_generators.html#module-mastml.feature_generators">mastml.feature_generators Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../5_feature_generators.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.BaseGenerator.html">BaseGenerator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.DataframeUtilities.html">DataframeUtilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.ElementalFeatureGenerator.html">ElementalFeatureGenerator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.MaterialsProjectFeatureGenerator.html">MaterialsProjectFeatureGenerator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.MatminerFeatureGenerator.html">MatminerFeatureGenerator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.OneHotElementEncoder.html">OneHotElementEncoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.OneHotGroupGenerator.html">OneHotGroupGenerator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_generators.PolynomialFeatureGenerator.html">PolynomialFeatureGenerator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../5_feature_generators.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../6_feature_selectors.html">Code Documentation: Feature Selectors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../6_feature_selectors.html#module-mastml.feature_selectors">mastml.feature_selectors Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../6_feature_selectors.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_selectors.BaseSelector.html">BaseSelector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_selectors.EnsembleModelFeatureSelector.html">EnsembleModelFeatureSelector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_selectors.MASTMLFeatureSelector.html">MASTMLFeatureSelector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_selectors.NoSelect.html">NoSelect</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_selectors.PearsonSelector.html">PearsonSelector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.feature_selectors.SklearnFeatureSelector.html">SklearnFeatureSelector</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../6_feature_selectors.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../7_hyper_opt.html">Code Documentation: Hyperparameter Optimization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../7_hyper_opt.html#module-mastml.hyper_opt">mastml.hyper_opt Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../7_hyper_opt.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.hyper_opt.BayesianSearch.html">BayesianSearch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.hyper_opt.GridSearch.html">GridSearch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.hyper_opt.HyperOptUtils.html">HyperOptUtils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.hyper_opt.RandomizedSearch.html">RandomizedSearch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../7_hyper_opt.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../8_learning_curve.html">Code Documentation: Learning Curve</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../8_learning_curve.html#module-mastml.learning_curve">mastml.learning_curve Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../8_learning_curve.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.learning_curve.LearningCurve.html">LearningCurve</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../8_learning_curve.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../9_mastml.html">Code Documentation: Mastml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../9_mastml.html#module-mastml.mastml">mastml.mastml Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../9_mastml.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.mastml.Mastml.html">Mastml</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../9_mastml.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../10_metrics.html">Code Documentation: Metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../10_metrics.html#module-mastml.metrics">mastml.metrics Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../10_metrics.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.metrics.r2_score_adjusted.html">r2_score_adjusted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.metrics.r2_score_fitted.html">r2_score_fitted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.metrics.r2_score_noint.html">r2_score_noint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.metrics.rmse_over_stdev.html">rmse_over_stdev</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.metrics.root_mean_squared_error.html">root_mean_squared_error</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../10_metrics.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.metrics.Metrics.html">Metrics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../10_metrics.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../11_models.html">Code Documentation: Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../11_models.html#module-mastml.models">mastml.models Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../11_models.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.models.EnsembleModel.html">EnsembleModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.models.SklearnModel.html">SklearnModel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../11_models.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../12_plots.html">Code Documentation: Plots</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../12_plots.html#module-mastml.plots">mastml.plots Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../12_plots.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.check_dimensions.html">check_dimensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.get_divisor.html">get_divisor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.make_axis_same.html">make_axis_same</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.make_fig_ax.html">make_fig_ax</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.make_fig_ax_square.html">make_fig_ax_square</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.make_plots.html">make_plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.nice_mean.html">nice_mean</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.nice_names.html">nice_names</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.nice_range.html">nice_range</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.nice_std.html">nice_std</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.plot_stats.html">plot_stats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.recursive_max.html">recursive_max</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.recursive_max_and_min.html">recursive_max_and_min</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.recursive_min.html">recursive_min</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.reset_index.html">reset_index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.round_down.html">round_down</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.round_up.html">round_up</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.rounder.html">rounder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.stat_to_string.html">stat_to_string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.trim_array.html">trim_array</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../12_plots.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.Error.html">Error</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.Histogram.html">Histogram</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.Line.html">Line</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.plots.Scatter.html">Scatter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../12_plots.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../13_preprocessing.html">Code Documentation: Preprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../13_preprocessing.html#module-mastml.preprocessing">mastml.preprocessing Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../13_preprocessing.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.preprocessing.BasePreprocessor.html">BasePreprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.preprocessing.MeanStdevScaler.html">MeanStdevScaler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.preprocessing.NoPreprocessor.html">NoPreprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/mastml.preprocessing.SklearnPreprocessor.html">SklearnPreprocessor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../13_preprocessing.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MAterials Simulation Toolkit for Machine Learning (MAST-ML)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>mastml.plots</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mastml.plots</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains classes used for generating different types of analysis plots</span>

<span class="sd">Scatter:</span>
<span class="sd">    This class contains a variety of scatter plot types, e.g. parity (predicted vs. true) plots</span>

<span class="sd">Error:</span>
<span class="sd">    This class contains plotting methods used to better quantify the model errors and uncertainty quantification.</span>

<span class="sd">Histogram:</span>
<span class="sd">    This class contains methods for constructing histograms of data distributions and visualization of model residuals.</span>

<span class="sd">Line:</span>
<span class="sd">    This class contains methods for making line plots, e.g. for constructing learning curves of model performance vs.</span>
<span class="sd">    amount of data or number of features.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">ceil</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span><span class="p">,</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="kn">from</span> <span class="nn">mastml.metrics</span> <span class="kn">import</span> <span class="n">Metrics</span>
<span class="kn">from</span> <span class="nn">mastml.error_analysis</span> <span class="kn">import</span> <span class="n">ErrorUtils</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_agg</span> <span class="kn">import</span> <span class="n">FigureCanvasAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span><span class="p">,</span> <span class="n">figaspect</span>
<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">FontProperties</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">mark_inset</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">zoomed_inset_axes</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">)</span>  <span class="c1"># set all font to bigger</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">autolayout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># turn on autolayout</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># adding dpi as a constant global so it can be changed later</span>
<span class="n">DPI</span> <span class="o">=</span> <span class="mi">250</span>


<div class="viewcode-block" id="Scatter"><a class="viewcode-back" href="../../api/mastml.plots.Scatter.html#mastml.plots.Scatter">[docs]</a><span class="k">class</span> <span class="nc">Scatter</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to generate scatter plots, such as parity plots showing true vs. predicted data values</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Methods:</span>

<span class="sd">        plot_predicted_vs_true: method to plot a parity plot</span>
<span class="sd">            Args:</span>
<span class="sd">                y_true: (pd.Series), series of true y data</span>

<span class="sd">                y_pred: (pd.Series), series of predicted y data</span>

<span class="sd">                savepath: (str), string denoting the save path for the figure image</span>

<span class="sd">                data_type: (str), string denoting the data type (e.g. train, test, leaveout)</span>

<span class="sd">                x_label: (str), string denoting the true and predicted property name</span>

<span class="sd">                metrics_list: (list), list of strings of metric names to evaluate and include on the figure</span>

<span class="sd">                show_figure: (bool), whether or not to show the figure output (e.g. when using Jupyter notebook)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_best_worst_split: method to find the best and worst split in an evaluation set and plot them together</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path for the figure image</span>

<span class="sd">                data_type: (str), string denoting the data type (e.g. train, test, leaveout)</span>

<span class="sd">                x_label: (str), string denoting the true and predicted property name</span>

<span class="sd">                metrics_list: (list), list of strings of metric names to evaluate and include on the figure</span>

<span class="sd">                show_figure: (bool), whether or not to show the figure output (e.g. when using Jupyter notebook)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_best_worst_per_point: method to find all of the best and worst data points from an evaluation set and plot them together</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path for the figure image</span>

<span class="sd">                data_type: (str), string denoting the data type (e.g. train, test, leaveout)</span>

<span class="sd">                x_label: (str), string denoting the true and predicted property name</span>

<span class="sd">                metrics_list: (list), list of strings of metric names to evaluate and include on the figure</span>

<span class="sd">                show_figure: (bool), whether or not to show the figure output (e.g. when using Jupyter notebook)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_predicted_vs_true_bars: method to plot the average predicted value of each data point from an evaluation set with error bars denoting the standard deviation in predicted values</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path for the figure image</span>

<span class="sd">                data_type: (str), string denoting the data type (e.g. train, test, leaveout)</span>

<span class="sd">                x_label: (str), string denoting the true and predicted property name</span>

<span class="sd">                metrics_list: (list), list of strings of metric names to evaluate and include on the figure</span>

<span class="sd">                show_figure: (bool), whether or not to show the figure output (e.g. when using Jupyter notebook)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_metric_vs_group: method to plot the metric value for each group during e.g. a LeaveOneGroupOut data split</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path for the figure image</span>

<span class="sd">                data_type: (str), string denoting the data type (e.g. train, test, leaveout)</span>

<span class="sd">                show_figure: (bool), whether or not to show the figure output (e.g. when using Jupyter notebook)</span>

<span class="sd">            Returns:</span>
<span class="sd">                 None</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Scatter.plot_predicted_vs_true"><a class="viewcode-back" href="../../api/mastml.plots.Scatter.html#mastml.plots.Scatter.plot_predicted_vs_true">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_predicted_vs_true</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">metrics_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Make the dataframe/array 1D if it isn&#39;t</span>
        <span class="n">y_true</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># Set image aspect ratio:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">()</span>

        <span class="c1"># gather max and min</span>
        <span class="n">max1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>
        <span class="n">min1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>

        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
        <span class="n">minn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">maxx</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minn</span><span class="p">))</span>
        <span class="n">minn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">minn</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minn</span><span class="p">))</span>
        <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># draw dashed horizontal line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="p">[</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span> <span class="o">+</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span> <span class="o">+</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">metrics_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use some default metric set</span>
            <span class="n">metrics_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r2_score&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="s1">&#39;root_mean_squared_error&#39;</span><span class="p">,</span> <span class="s1">&#39;rmse_over_stdev&#39;</span><span class="p">]</span>
        <span class="n">stats_dict</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">(</span><span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics_list</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">)</span>

        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats_dict</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;parity_plot_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_figure</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Scatter.plot_best_worst_split"><a class="viewcode-back" href="../../api/mastml.plots.Scatter.html#mastml.plots.Scatter.plot_best_worst_split">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_best_worst_split</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">metrics_list</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">dirs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">splitdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="s1">&#39;split_&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="ow">and</span> <span class="s1">&#39;.png&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>

        <span class="n">stats_files_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">splitdir</span> <span class="ow">in</span> <span class="n">splitdirs</span><span class="p">:</span>
            <span class="n">stats_files_dict</span><span class="p">[</span><span class="n">splitdir</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="n">data_type</span> <span class="o">+</span> <span class="s1">&#39;_stats_summary.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Find best/worst splits based on RMSE value</span>
        <span class="n">rmse_best</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">20</span>
        <span class="n">rmse_worst</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">split</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">stats_files_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s1">&#39;root_mean_squared_error&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rmse_best</span><span class="p">:</span>
                <span class="n">best_split</span> <span class="o">=</span> <span class="n">split</span>
                <span class="n">rmse_best</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s1">&#39;root_mean_squared_error&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s1">&#39;root_mean_squared_error&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rmse_worst</span><span class="p">:</span>
                <span class="n">worst_split</span> <span class="o">=</span> <span class="n">split</span>
                <span class="n">rmse_worst</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s1">&#39;root_mean_squared_error&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span><span class="p">:</span>
            <span class="n">y_true_best</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">best_split</span><span class="p">),</span> <span class="s1">&#39;y_test.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>
            <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">best_split</span><span class="p">),</span> <span class="s1">&#39;y_pred.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>
            <span class="n">y_true_worst</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">worst_split</span><span class="p">),</span> <span class="s1">&#39;y_test.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>
            <span class="n">y_pred_worst</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">worst_split</span><span class="p">),</span> <span class="s1">&#39;y_pred.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">:</span>
            <span class="n">y_true_best</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">best_split</span><span class="p">),</span> <span class="s1">&#39;y_train.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>
            <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">best_split</span><span class="p">),</span> <span class="s1">&#39;y_pred_train.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>
            <span class="n">y_true_worst</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">worst_split</span><span class="p">),</span> <span class="s1">&#39;y_train.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>
            <span class="n">y_pred_worst</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">worst_split</span><span class="p">),</span> <span class="s1">&#39;y_pred_train.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>

        <span class="c1"># Make the dataframe/array 1D if it isn&#39;t</span>
        <span class="n">y_true_best</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_true_best</span><span class="p">)</span>
        <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_pred_best</span><span class="p">)</span>
        <span class="n">y_true_worst</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_true_worst</span><span class="p">)</span>
        <span class="n">y_pred_worst</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_pred_worst</span><span class="p">)</span>

        <span class="c1"># Set image aspect ratio:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">()</span>

        <span class="c1"># gather max and min</span>
        <span class="n">max1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_true_best</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_pred_best</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_true_worst</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_pred_worst</span><span class="p">))</span>
        <span class="n">min1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_true_best</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_pred_best</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_true_worst</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_pred_worst</span><span class="p">))</span>

        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span> <span class="o">-</span> <span class="n">min1</span><span class="p">))</span>
        <span class="n">minn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span> <span class="o">-</span> <span class="n">min1</span><span class="p">))</span>
        <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_true_best</span><span class="p">,</span> <span class="n">y_pred_best</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best split&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_true_worst</span><span class="p">,</span> <span class="n">y_pred_worst</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Worst split&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

        <span class="c1"># draw dashed horizontal line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="p">[</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span> <span class="o">+</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span> <span class="o">+</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="n">stats_dict_best</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">(</span><span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics_list</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true_best</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred_best</span><span class="p">)</span>
        <span class="n">stats_dict_worst</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">(</span><span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics_list</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true_worst</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred_worst</span><span class="p">)</span>

        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats_dict_best</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">font_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>
        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats_dict_worst</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">font_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">})</span>

        <span class="c1"># Save data to excel file and image</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;parity_plot_best_worst_split_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_figure</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

    <span class="c1">#TODO: this method runs into issues when the y_true data have multiple instances where the y data have the same value, leading to size mismatch errors</span>
<div class="viewcode-block" id="Scatter.plot_best_worst_per_point"><a class="viewcode-back" href="../../api/mastml.plots.Scatter.html#mastml.plots.Scatter.plot_best_worst_per_point">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_best_worst_per_point</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">metrics_list</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Get lists of all ytrue and ypred for each split</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">splitdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="s1">&#39;split_&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="ow">and</span> <span class="s1">&#39;.png&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>

        <span class="n">y_true_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">y_pred_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">splitdir</span> <span class="ow">in</span> <span class="n">splitdirs</span><span class="p">:</span>
            <span class="n">y_true_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span><span class="p">:</span>
                <span class="n">y_pred_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;y_pred.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">:</span>
                <span class="n">y_pred_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;y_pred_train.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">))</span>

        <span class="n">all_y_true</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">all_y_pred</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">all_abs_residuals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">yt</span><span class="p">,</span> <span class="n">y_pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_true_list</span><span class="p">,</span> <span class="n">y_pred_list</span><span class="p">):</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">check_dimensions</span><span class="p">(</span><span class="n">yt</span><span class="p">))</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>
            <span class="n">abs_residuals</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yt</span><span class="o">-</span><span class="n">y_pred</span><span class="p">)</span>
            <span class="n">all_y_true</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>
            <span class="n">all_y_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
            <span class="n">all_abs_residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abs_residuals</span><span class="p">)</span>
        <span class="n">all_y_true_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_y_true</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
        <span class="n">all_y_pred_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_y_pred</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
        <span class="n">all_residuals_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_abs_residuals</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>

        <span class="c1"># TODO: this is the source of the issue, as y_true_unique can be smaller than y_true. A better way?</span>
        <span class="n">y_true_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_y_true_flat</span><span class="p">)</span>
        <span class="n">bests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">worsts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">yt</span> <span class="ow">in</span> <span class="n">y_true_unique</span><span class="p">:</span>
            <span class="n">best</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">all_y_pred_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_y_true_flat</span> <span class="o">==</span> <span class="n">yt</span><span class="p">)]</span> <span class="o">-</span> <span class="n">all_y_true_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_y_true_flat</span> <span class="o">==</span> <span class="n">yt</span><span class="p">)]))</span>
            <span class="n">worst</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">all_y_pred_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_y_true_flat</span> <span class="o">==</span> <span class="n">yt</span><span class="p">)]</span> <span class="o">-</span> <span class="n">all_y_true_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_y_true_flat</span> <span class="o">==</span> <span class="n">yt</span><span class="p">)]))</span>
            <span class="n">bests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_y_pred_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_residuals_flat</span> <span class="o">==</span> <span class="n">best</span><span class="p">)])</span>
            <span class="n">worsts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_y_pred_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_residuals_flat</span> <span class="o">==</span> <span class="n">worst</span><span class="p">)])</span>

        <span class="n">bests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">bests</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
        <span class="n">worsts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">worsts</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>

        <span class="n">stats_dict_best</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">(</span><span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics_list</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true_unique</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">bests</span><span class="p">)</span>
        <span class="n">stats_dict_worst</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">(</span><span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics_list</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true_unique</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">worsts</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">)</span>

        <span class="c1"># gather max and min</span>
        <span class="n">max1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">y_true_unique</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">bests</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">worsts</span><span class="p">)])</span>
        <span class="n">min1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">y_true_unique</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">bests</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">worsts</span><span class="p">)])</span>

        <span class="c1"># draw dashed horizontal line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="p">[</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># set axis labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span><span class="o">+</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span><span class="o">+</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

        <span class="c1"># set tick labels</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span><span class="o">-</span><span class="n">min1</span><span class="p">))</span>
        <span class="n">minn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min1</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max1</span><span class="o">-</span><span class="n">min1</span><span class="p">))</span>
        <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_true_unique</span><span class="p">,</span> <span class="n">bests</span><span class="p">,</span>  <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;best all points&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_true_unique</span><span class="p">,</span> <span class="n">worsts</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;worst all points&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1">#plot_stats(fig, avg_stats, x_align=x_align, y_align=0.51, fontsize=10)</span>
        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats_dict_best</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">font_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">})</span>
        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats_dict_worst</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">font_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">})</span>

        <span class="c1"># Save data to excel file and image</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;parity_plot_best_worst_eachpoint_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_figure</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Scatter.plot_predicted_vs_true_bars"><a class="viewcode-back" href="../../api/mastml.plots.Scatter.html#mastml.plots.Scatter.plot_predicted_vs_true_bars">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_predicted_vs_true_bars</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">metrics_list</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Get lists of all ytrue and ypred for each split</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">splitdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="s1">&#39;split_&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="ow">and</span> <span class="s1">&#39;.png&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>

        <span class="n">y_true_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">y_pred_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">splitdir</span> <span class="ow">in</span> <span class="n">splitdirs</span><span class="p">:</span>
            <span class="n">y_true_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span><span class="p">:</span>
                <span class="n">y_pred_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;y_pred.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">:</span>
                <span class="n">y_pred_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;y_pred_train.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;leaveout&#39;</span><span class="p">:</span>
                <span class="n">y_pred_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;y_pred_leaveout.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">))</span>

        <span class="n">all_y_true</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">all_y_pred</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">yt</span><span class="p">,</span> <span class="n">y_pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_true_list</span><span class="p">,</span> <span class="n">y_pred_list</span><span class="p">):</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">check_dimensions</span><span class="p">(</span><span class="n">yt</span><span class="p">))</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>
            <span class="n">all_y_true</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>
            <span class="n">all_y_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>

        <span class="n">df_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;all_y_true&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_y_true</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]),</span>
                               <span class="s1">&#39;all_y_pred&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_y_pred</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])})</span>

        <span class="n">df_all_grouped</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;all_y_true&#39;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df_avg</span> <span class="o">=</span> <span class="n">df_all_grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">df_std</span> <span class="o">=</span> <span class="n">df_all_grouped</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
        <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

        <span class="c1"># gather max and min</span>
        <span class="n">max1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">df_avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">df_avg</span><span class="p">[</span><span class="s1">&#39;all_y_pred&#39;</span><span class="p">]))</span>
        <span class="n">min1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">df_avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">df_avg</span><span class="p">[</span><span class="s1">&#39;all_y_pred&#39;</span><span class="p">]))</span>

        <span class="c1"># draw dashed horizontal line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="p">[</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># set axis labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True &#39;</span> <span class="o">+</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted &#39;</span> <span class="o">+</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

        <span class="c1"># set tick labels</span>
        <span class="n">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max1</span><span class="p">,</span> <span class="n">min1</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">df_avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">df_avg</span><span class="p">[</span><span class="s1">&#39;all_y_pred&#39;</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">df_std</span><span class="p">[</span><span class="s1">&#39;all_y_pred&#39;</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">stats_files_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">splitdir</span> <span class="ow">in</span> <span class="n">splitdirs</span><span class="p">:</span>
            <span class="n">stats_files_dict</span><span class="p">[</span><span class="n">splitdir</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="n">data_type</span> <span class="o">+</span> <span class="s1">&#39;_stats_summary.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">metrics_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stats_files_dict</span><span class="p">[</span><span class="n">splitdir</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">avg_stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_list</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">splitdir</span> <span class="ow">in</span> <span class="n">splitdirs</span><span class="p">:</span>
                <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_files_dict</span><span class="p">[</span><span class="n">splitdir</span><span class="p">][</span><span class="n">metric</span><span class="p">])</span>

            <span class="n">avg_stats</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">stats</span><span class="p">))</span>

        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;parity_plot_allsplits_average_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;y true&#39;</span><span class="p">:</span> <span class="n">df_avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                           <span class="s1">&#39;average predicted values&#39;</span><span class="p">:</span> <span class="n">df_avg</span><span class="p">[</span><span class="s1">&#39;all_y_pred&#39;</span><span class="p">],</span>
                           <span class="s1">&#39;error bar values&#39;</span><span class="p">:</span> <span class="n">df_std</span><span class="p">[</span><span class="s1">&#39;all_y_pred&#39;</span><span class="p">]})</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;parity_plot_allsplits_average_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">show_figure</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Scatter.plot_metric_vs_group"><a class="viewcode-back" href="../../api/mastml.plots.Scatter.html#mastml.plots.Scatter.plot_metric_vs_group">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_metric_vs_group</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">show_figure</span><span class="p">):</span>

        <span class="n">dirs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">splitdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="s1">&#39;split_&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="ow">and</span> <span class="s1">&#39;.png&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>

        <span class="n">stats_files_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">splitdir</span> <span class="ow">in</span> <span class="n">splitdirs</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="s1">&#39;test_group.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">stats_files_dict</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">splitdir</span><span class="p">),</span> <span class="n">data_type</span> <span class="o">+</span> <span class="s1">&#39;_stats_summary.xlsx&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">metrics_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stats_files_dict</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_list</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_files_dict</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">metric</span><span class="p">])</span>

            <span class="n">avg_stats</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stats</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">stats</span><span class="p">))}</span>

            <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
            <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

            <span class="c1"># do the actual plotting</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

            <span class="c1"># set axis labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">avg_stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_value_per_group_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_figure</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../api/mastml.plots.Error.html#mastml.plots.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to make plots related to model error assessment and uncertainty quantification</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Methods:</span>
<span class="sd">        plot_normalized_error: Method to plot the normalized residual errors of a model prediction</span>
<span class="sd">            Args:</span>
<span class="sd">                residuals: (pd.Series), series containing the true errors (model residuals)</span>

<span class="sd">                savepath: (str), string denoting the save path to save the figure to</span>

<span class="sd">                data_type: (str), string denoting the data type, e.g. train, test, leftout</span>

<span class="sd">                model_errors: (pd.Series), series containing the predicted model errors (optional, default None)</span>

<span class="sd">                show_figure: (bool), whether or not the generated figure is output to the notebook screen (default False)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_cumulative_normalized_error: Method to plot the cumulative normalized residual errors of a model prediction</span>
<span class="sd">            Args:</span>
<span class="sd">                residuals: (pd.Series), series containing the true errors (model residuals)</span>

<span class="sd">                savepath: (str), string denoting the save path to save the figure to</span>

<span class="sd">                data_type: (str), string denoting the data type, e.g. train, test, leftout</span>

<span class="sd">                model_errors: (pd.Series), series containing the predicted model errors (optional, default None)</span>

<span class="sd">                show_figure: (bool), whether or not the generated figure is output to the notebook screen (default False)</span>


<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_rstat: Method for plotting the r-statistic distribution (true divided by predicted error)</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path to save the figure to</span>

<span class="sd">                data_type: (str), string denoting the data type, e.g. train, test, leftout</span>

<span class="sd">                residuals: (pd.Series), series containing the true errors (model residuals)</span>

<span class="sd">                model_errors: (pd.Series), series containing the predicted model errors</span>

<span class="sd">                show_figure: (bool), whether or not the generated figure is output to the notebook screen (default False)</span>

<span class="sd">                is_calibrated: (bool), whether or not the model errors have been recalibrated (default False)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_rstat_uncal_cal_overlay: Method for plotting the r-statistic distribution for two cases together: the as-obtained uncalibrated model errors and calibrated errors</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path to save the figure to</span>

<span class="sd">                data_type: (str), string denoting the data type, e.g. train, test, leftout</span>

<span class="sd">                residuals: (pd.Series), series containing the true errors (model residuals)</span>

<span class="sd">                model_errors: (pd.Series), series containing the predicted model errors</span>

<span class="sd">                model_errors_cal: (pd.Series), series containing the calibrated predicted model errors</span>

<span class="sd">                show_figure: (bool), whether or not the generated figure is output to the notebook screen (default False)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_real_vs_predicted_error: Sometimes called the RvE plot, or residual vs. error plot, this method plots the binned RMS residuals as a function of the binned model errors</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path to save the figure to</span>

<span class="sd">                model: (mastml.models object), a MAST-ML model object, e.g. SklearnModel or EnsembleModel</span>

<span class="sd">                data_type: (str), string denoting the data type, e.g. train, test, leftout</span>

<span class="sd">                model_errors: (pd.Series), series containing the predicted model errors</span>

<span class="sd">                residuals: (pd.Series), series containing the true errors (model residuals)</span>

<span class="sd">                dataset_stdev: (float), the standard deviation of the training dataset</span>

<span class="sd">                show_figure: (bool), whether or not the generated figure is output to the notebook screen (default False)</span>

<span class="sd">                is_calibrated: (bool), whether or not the model errors have been recalibrated (default False)</span>

<span class="sd">                well_sampled_fraction: (float), number denoting whether a bin qualifies as well-sampled or not. Default to 0.025 (2.5% of total samples). Only affects visuals, not fitting</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_real_vs_predicted_error_uncal_cal_overlay: Method for making the residual vs. error plot for two cases together: using the as-obtained uncalibrated model errors and calibrated errors</span>
<span class="sd">            Args:</span>
<span class="sd">                savepath: (str), string denoting the save path to save the figure to</span>

<span class="sd">                model: (mastml.models object), a MAST-ML model object, e.g. SklearnModel or EnsembleModel</span>

<span class="sd">                data_type: (str), string denoting the data type, e.g. train, test, leftout</span>

<span class="sd">                model_errors: (pd.Series), series containing the predicted model errors</span>

<span class="sd">                model_errors_cal: (pd.Series), series containing the calibrated predicted model errors</span>

<span class="sd">                residuals: (pd.Series), series containing the true errors (model residuals)</span>

<span class="sd">                dataset_stdev: (float), the standard deviation of the training dataset</span>

<span class="sd">                show_figure: (bool), whether or not the generated figure is output to the notebook screen (default False)</span>

<span class="sd">                well_sampled_fraction: (float), number denoting whether a bin qualifies as well-sampled or not. Default to 0.025 (2.5% of total samples). Only affects visuals, not fitting</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Error.plot_normalized_error"><a class="viewcode-back" href="../../api/mastml.plots.Error.html#mastml.plots.Error.plot_normalized_error">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_normalized_error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">model_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">residuals</span><span class="p">[</span><span class="n">residuals</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
        <span class="n">normalized_residuals</span> <span class="o">=</span> <span class="n">residuals</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
        <span class="n">density_residuals</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">normalized_residuals</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">residuals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analytical Gaussian&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Residuals&quot;</span><span class="p">)</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">minn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>

        <span class="k">if</span> <span class="n">model_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model_errors</span><span class="p">[</span><span class="n">model_errors</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0001</span>
            <span class="n">rstat</span> <span class="o">=</span> <span class="n">residuals</span> <span class="o">/</span> <span class="n">model_errors</span>
            <span class="n">density_errors</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">rstat</span><span class="p">)</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">min</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Plotted x values&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;model_errors&quot;</span><span class="p">:</span> <span class="n">model_errors</span><span class="p">,</span>
                         <span class="c1"># &quot;analytical gaussian (plotted y blue values)&quot;: norm.pdf(x, mu, sigma),</span>
                         <span class="s2">&quot;residuals&quot;</span><span class="p">:</span> <span class="n">residuals</span><span class="p">,</span>
                         <span class="s2">&quot;model normalized residuals (plotted y green values)&quot;</span><span class="p">:</span> <span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                         <span class="s2">&quot;model errors (plotted y purple values)&quot;</span><span class="p">:</span> <span class="n">density_errors</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;normalized_error_data_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x values&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                         <span class="c1"># &quot;analytical gaussian&quot;: norm.pdf(x, mu, sigma),</span>
                         <span class="s2">&quot;model normalized residuals (plotted y green values)&quot;</span><span class="p">:</span> <span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;normalized_error_data_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">))</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)))</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">density_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">min</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathrm</span><span class="si">{x}</span><span class="s2">/\mathit{\sigma}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability density&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">miny</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;normalized_errors_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_figure</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Error.plot_cumulative_normalized_error"><a class="viewcode-back" href="../../api/mastml.plots.Error.html#mastml.plots.Error.plot_cumulative_normalized_error">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_cumulative_normalized_error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">model_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

        <span class="n">analytic_gau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="n">analytic_gau</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">)</span>
        <span class="n">n_analytic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">))</span>
        <span class="n">X_analytic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">analytic_gau</span><span class="p">)</span>
        <span class="n">residuals</span><span class="p">[</span><span class="n">residuals</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span>
        <span class="n">normalized_residuals</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">residuals</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span><span class="p">))</span>
        <span class="n">n_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">normalized_residuals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">normalized_residuals</span><span class="p">))</span>
        <span class="n">X_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">normalized_residuals</span><span class="p">)</span>  <span class="c1"># r&quot;$\mathrm{Predicted \/ Value}, \mathit{eV}$&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathrm</span><span class="si">{x}</span><span class="s2">/\mathit{\sigma}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_residuals</span><span class="p">,</span> <span class="n">n_residuals</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Residuals&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_analytic</span><span class="p">,</span> <span class="n">n_analytic</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analytical Gaussian&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">model_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model_errors</span><span class="p">[</span><span class="n">model_errors</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0001</span>
            <span class="n">rstat</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">residuals</span><span class="p">)</span> <span class="o">/</span> <span class="n">model_errors</span><span class="p">)</span>
            <span class="n">n_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rstat</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rstat</span><span class="p">))</span>
            <span class="n">X_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">rstat</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_errors</span><span class="p">,</span> <span class="n">n_errors</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># &quot;Analytical Gaussian values&quot;: analytic_gau,</span>
                <span class="c1"># &quot;Analytical Gaussian (sorted, blue data)&quot;: X_analytic,</span>
                <span class="s2">&quot;residuals&quot;</span><span class="p">:</span> <span class="n">residuals</span><span class="p">,</span>
                <span class="s2">&quot;normalized residuals&quot;</span><span class="p">:</span> <span class="n">normalized_residuals</span><span class="p">,</span>
                <span class="s2">&quot;Model Residuals (sorted, green data)&quot;</span><span class="p">:</span> <span class="n">X_residuals</span><span class="p">,</span>
                <span class="s2">&quot;Model error values (r value: (ytrue-ypred)/(model error avg))&quot;</span><span class="p">:</span> <span class="n">rstat</span><span class="p">,</span>
                <span class="s2">&quot;Model errors (sorted, purple values)&quot;</span><span class="p">:</span> <span class="n">X_errors</span><span class="p">}</span>
            <span class="c1"># Save this way to avoid issue with different array sizes in data_dict</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;cumulative_normalized_errors_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Save data to csv file</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># &quot;x analytical&quot;: X_analytic,</span>
                <span class="c1"># &quot;analytical gaussian&quot;: n_analytic,</span>
                <span class="s2">&quot;Model Residuals (sorted, green data)&quot;</span><span class="p">:</span> <span class="n">X_residuals</span><span class="p">,</span>
                <span class="s2">&quot;model residuals&quot;</span><span class="p">:</span> <span class="n">n_residuals</span><span class="p">}</span>
            <span class="c1"># Save this way to avoid issue with different array sizes in data_dict</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;cumulative_normalized_errors_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">xlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ylabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">axin</span> <span class="o">=</span> <span class="n">zoomed_inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">axin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_residuals</span><span class="p">,</span> <span class="n">n_residuals</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Residuals&quot;</span><span class="p">)</span>
        <span class="n">axin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_analytic</span><span class="p">,</span> <span class="n">n_analytic</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analytical Gaussian&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">X_errors</span><span class="p">,</span> <span class="n">n_errors</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model Errors&quot;</span><span class="p">)</span>
        <span class="n">axin</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xlabels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">axin</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">axin</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">axin</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">maxx</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">minn</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="mf">1.1</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">miny</span><span class="p">)</span>

        <span class="n">mark_inset</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">axin</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;cumulative_normalized_errors_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_figure</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Error.plot_rstat"><a class="viewcode-back" href="../../api/mastml.plots.Error.html#mastml.plots.Error.plot_rstat">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_rstat</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">model_errors</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_calibrated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Eliminate model errors with value 0, so that the ratios can be calculated</span>
        <span class="n">zero_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_errors</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">model_errors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zero_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">zero_indices</span><span class="p">)</span>
        <span class="n">model_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">model_errors</span><span class="p">,</span> <span class="n">zero_indices</span><span class="p">)</span>
        <span class="c1"># make data for gaussian plot</span>
        <span class="n">gaussian_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="c1"># create plot</span>
        <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;residuals / model error estimates&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative counts&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="o">/</span><span class="n">model_errors</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gaussian_x</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">gaussian_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian mu: 0 std: 1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;mean = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">residuals</span> <span class="o">/</span> <span class="n">model_errors</span><span class="p">)),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;std = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span> <span class="o">/</span> <span class="n">model_errors</span><span class="p">)),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_calibrated</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">calibrate</span> <span class="o">=</span> <span class="s1">&#39;uncalibrated&#39;</span>
        <span class="k">if</span> <span class="n">is_calibrated</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">calibrate</span> <span class="o">=</span> <span class="s1">&#39;calibrated&#39;</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;rstat_histogram_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">calibrate</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_figure</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Error.plot_rstat_uncal_cal_overlay"><a class="viewcode-back" href="../../api/mastml.plots.Error.html#mastml.plots.Error.plot_rstat_uncal_cal_overlay">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_rstat_uncal_cal_overlay</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">model_errors</span><span class="p">,</span> <span class="n">model_errors_cal</span><span class="p">,</span>
                                     <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Eliminate model errors with value 0, so that the ratios can be calculated</span>
        <span class="n">zero_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_errors</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">model_errors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zero_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">zero_indices</span><span class="p">)</span>
        <span class="n">model_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">model_errors</span><span class="p">,</span> <span class="n">zero_indices</span><span class="p">)</span>
        <span class="n">model_errors_cal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">model_errors_cal</span><span class="p">,</span> <span class="n">zero_indices</span><span class="p">)</span>

        <span class="c1"># make data for gaussian plot</span>
        <span class="n">gaussian_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="c1"># create plot</span>
        <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.64</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;residuals / model error estimates&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative counts&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="o">/</span><span class="n">model_errors</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="o">/</span><span class="n">model_errors_cal</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gaussian_x</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">gaussian_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian mu: 0 std: 1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;mean = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">residuals</span> <span class="o">/</span> <span class="n">model_errors</span><span class="p">)),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;std = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span> <span class="o">/</span> <span class="n">model_errors</span><span class="p">)),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;mean = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">residuals</span> <span class="o">/</span> <span class="n">model_errors_cal</span><span class="p">)),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="s1">&#39;std = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span> <span class="o">/</span> <span class="n">model_errors_cal</span><span class="p">)),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;rstat_histogram_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_uncal_cal_overlay.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_figure</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Error.plot_real_vs_predicted_error"><a class="viewcode-back" href="../../api/mastml.plots.Error.html#mastml.plots.Error.plot_real_vs_predicted_error">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_real_vs_predicted_error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">model_errors</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">dataset_stdev</span><span class="p">,</span>
                                     <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_calibrated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">well_sampled_fraction</span><span class="o">=</span><span class="mf">0.025</span><span class="p">):</span>

        <span class="n">bin_values</span><span class="p">,</span> <span class="n">rms_residual_values</span><span class="p">,</span> <span class="n">num_values_per_bin</span><span class="p">,</span> <span class="n">number_of_bins</span> <span class="o">=</span> <span class="n">ErrorUtils</span><span class="p">()</span><span class="o">.</span><span class="n">_parse_error_data</span><span class="p">(</span><span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                                                                                                             <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                                                                                             <span class="n">dataset_stdev</span><span class="o">=</span><span class="n">dataset_stdev</span><span class="p">)</span>

        <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;RandomForestRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;RF&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;GradientBoostingRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;GBR&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;ExtraTreesRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;ET&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;GaussianProcessRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;GPR&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;BaggingRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;BR&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;AdaBoostRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;ABR&#39;</span>

        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;leaveout&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: data_test_type must be one of &quot;train&quot;, &quot;test&quot; or &quot;leaveout&quot;&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="c1"># Make RF error plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">)</span>

        <span class="n">linear</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Fit just blue circle data</span>
        <span class="c1"># Find nan entries</span>
        <span class="n">nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rms_residual_values</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># use nans (which are indices) to delete relevant parts of bin_values and</span>
        <span class="c1"># rms_residual_values as they can&#39;t be used to fit anyway</span>
        <span class="n">bin_values_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">bin_values</span><span class="p">)</span>
        <span class="n">bin_values_copy</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">bin_values</span>
        <span class="n">rms_residual_values_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">rms_residual_values</span><span class="p">)</span>
        <span class="n">rms_residual_values_copy</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">rms_residual_values</span>
        <span class="n">bin_values_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">bin_values_copy</span><span class="p">,</span> <span class="n">nans</span><span class="p">)</span>
        <span class="n">rms_residual_values_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">rms_residual_values_copy</span><span class="p">,</span> <span class="n">nans</span><span class="p">)</span>

        <span class="n">num_values_per_bin_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">num_values_per_bin</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">num_values_per_bin</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Only examine the bins that are well-sampled, i.e. have number of data points in them above a given threshold</span>
        <span class="n">well_sampled_number</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">well_sampled_fraction</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">num_values_per_bin_copy</span><span class="p">))</span>
        <span class="n">rms_residual_values_wellsampled</span> <span class="o">=</span> <span class="n">rms_residual_values_copy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_copy</span> <span class="o">&gt;</span> <span class="n">well_sampled_number</span><span class="p">)]</span>
        <span class="n">bin_values_wellsampled</span> <span class="o">=</span> <span class="n">bin_values_copy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_copy</span> <span class="o">&gt;</span> <span class="n">well_sampled_number</span><span class="p">)]</span>
        <span class="n">num_values_per_bin_wellsampled</span> <span class="o">=</span> <span class="n">num_values_per_bin_copy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_copy</span> <span class="o">&gt;</span> <span class="n">well_sampled_number</span><span class="p">)]</span>
        <span class="n">rms_residual_values_poorlysampled</span> <span class="o">=</span> <span class="n">rms_residual_values_copy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_copy</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number</span><span class="p">)]</span>
        <span class="n">bin_values_poorlysampled</span> <span class="o">=</span> <span class="n">bin_values_copy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_copy</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number</span><span class="p">)]</span>
        <span class="n">num_values_per_bin_poorlysampled</span> <span class="o">=</span> <span class="n">num_values_per_bin_copy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_copy</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number</span><span class="p">)]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_values_wellsampled</span><span class="p">,</span> <span class="n">rms_residual_values_wellsampled</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_values_poorlysampled</span><span class="p">,</span> <span class="n">rms_residual_values_poorlysampled</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; model errors / dataset stdev&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RMS Absolute residuals</span><span class="se">\n</span><span class="s1"> / dataset stdev&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rms_residual_values_copy</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---WARNING: ALL ERRORS TOO LARGE FOR PLOTTING---&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fit the line to all data, including the poorly sampled data, and weight data points by number of samples per bin</span>
            <span class="n">linear</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_values_copy</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rms_residual_values_copy</span><span class="p">,</span>
                       <span class="n">sample_weight</span><span class="o">=</span><span class="n">num_values_per_bin_copy</span><span class="p">)</span>
            <span class="n">yfit</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_values_copy</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_values_copy</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">rms_residual_values_copy</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">num_values_per_bin_copy</span><span class="p">)</span>

            <span class="n">slope</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">coef_</span>
            <span class="n">intercept</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">intercept_</span>

        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">axbarx</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">axbarx</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bin_values</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">num_values_per_bin</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">bin_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">bin_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="n">total_samples</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">num_values_per_bin</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.67</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">num_values_per_bin</span><span class="p">)),</span> <span class="s1">&#39;Total counts = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_samples</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">bin_values_copy</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">rms_residual_values</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">ymax</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">num_values_per_bin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">xmax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;R$^2$ = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">r2</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;slope = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">slope</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;intercept = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">})</span>

        <span class="c1"># Plot y = x line as reference point</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxx</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxx</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_calibrated</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">calibrate</span> <span class="o">=</span> <span class="s1">&#39;uncalibrated&#39;</span>
        <span class="k">if</span> <span class="n">is_calibrated</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">calibrate</span> <span class="o">=</span> <span class="s1">&#39;calibrated&#39;</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_residuals_vs_modelerror_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">calibrate</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_figure</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="Error.plot_real_vs_predicted_error_uncal_cal_overlay"><a class="viewcode-back" href="../../api/mastml.plots.Error.html#mastml.plots.Error.plot_real_vs_predicted_error_uncal_cal_overlay">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_real_vs_predicted_error_uncal_cal_overlay</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">model_errors</span><span class="p">,</span> <span class="n">model_errors_cal</span><span class="p">,</span>
                                                       <span class="n">residuals</span><span class="p">,</span> <span class="n">dataset_stdev</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">well_sampled_fraction</span><span class="o">=</span><span class="mf">0.025</span><span class="p">):</span>

        <span class="n">bin_values_uncal</span><span class="p">,</span> <span class="n">rms_residual_values_uncal</span><span class="p">,</span> <span class="n">num_values_per_bin_uncal</span><span class="p">,</span> <span class="n">number_of_bins_uncal</span> <span class="o">=</span> <span class="n">ErrorUtils</span><span class="p">()</span><span class="o">.</span><span class="n">_parse_error_data</span><span class="p">(</span><span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                                                                                                                                     <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                                                                                                                     <span class="n">dataset_stdev</span><span class="o">=</span><span class="n">dataset_stdev</span><span class="p">)</span>

        <span class="n">bin_values_cal</span><span class="p">,</span> <span class="n">rms_residual_values_cal</span><span class="p">,</span> <span class="n">num_values_per_bin_cal</span><span class="p">,</span> <span class="n">number_of_bins_cal</span> <span class="o">=</span> <span class="n">ErrorUtils</span><span class="p">()</span><span class="o">.</span><span class="n">_parse_error_data</span><span class="p">(</span><span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors_cal</span><span class="p">,</span>
                                                                                                                             <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                                                                                                             <span class="n">dataset_stdev</span><span class="o">=</span><span class="n">dataset_stdev</span><span class="p">)</span>

        <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;RandomForestRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;RF&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;GradientBoostingRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;GBR&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;ExtraTreesRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;ET&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;GaussianProcessRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;GPR&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;BaggingRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;BR&#39;</span>
        <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;AdaBoostRegressor&#39;</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;ABR&#39;</span>

        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;leaveout&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: data_test_type must be one of &quot;train&quot;, &quot;test&quot; or &quot;leaveout&quot;&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="c1"># Make RF error plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">)</span>

        <span class="n">linear_uncal</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">linear_cal</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Only examine the bins that are well-sampled, i.e. have number of data points in them above a given threshold</span>
        <span class="n">well_sampled_number_uncal</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">well_sampled_fraction</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span><span class="p">))</span>
        <span class="n">rms_residual_values_wellsampled_uncal</span> <span class="o">=</span> <span class="n">rms_residual_values_uncal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span> <span class="o">&gt;</span> <span class="n">well_sampled_number_uncal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">bin_values_wellsampled_uncal</span> <span class="o">=</span> <span class="n">bin_values_uncal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span> <span class="o">&gt;</span> <span class="n">well_sampled_number_uncal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">num_values_per_bin_wellsampled_uncal</span> <span class="o">=</span> <span class="n">num_values_per_bin_uncal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span> <span class="o">&gt;</span> <span class="n">well_sampled_number_uncal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">rms_residual_values_poorlysampled_uncal</span> <span class="o">=</span> <span class="n">rms_residual_values_uncal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number_uncal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">bin_values_poorlysampled_uncal</span> <span class="o">=</span> <span class="n">bin_values_uncal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number_uncal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">num_values_per_bin_poorlysampled_uncal</span> <span class="o">=</span> <span class="n">num_values_per_bin_uncal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number_uncal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">well_sampled_number_cal</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">well_sampled_fraction</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">num_values_per_bin_cal</span><span class="p">))</span>
        <span class="n">rms_residual_values_wellsampled_cal</span> <span class="o">=</span> <span class="n">rms_residual_values_cal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_cal</span> <span class="o">&gt;</span> <span class="n">well_sampled_number_cal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">bin_values_wellsampled_cal</span> <span class="o">=</span> <span class="n">bin_values_cal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_cal</span> <span class="o">&gt;</span> <span class="n">well_sampled_number_cal</span><span class="p">)]</span>
        <span class="n">num_values_per_bin_wellsampled_cal</span> <span class="o">=</span> <span class="n">num_values_per_bin_cal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_cal</span> <span class="o">&gt;</span> <span class="n">well_sampled_number_cal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">rms_residual_values_poorlysampled_cal</span> <span class="o">=</span> <span class="n">rms_residual_values_cal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_cal</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number_cal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">bin_values_poorlysampled_cal</span> <span class="o">=</span> <span class="n">bin_values_cal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_cal</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number_cal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">num_values_per_bin_poorlysampled_cal</span> <span class="o">=</span> <span class="n">num_values_per_bin_cal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_values_per_bin_cal</span> <span class="o">&lt;=</span> <span class="n">well_sampled_number_cal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_values_wellsampled_uncal</span><span class="p">,</span> <span class="n">rms_residual_values_wellsampled_uncal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;uncalibrated&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_values_poorlysampled_uncal</span><span class="p">,</span> <span class="n">rms_residual_values_poorlysampled_uncal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_values_wellsampled_cal</span><span class="p">,</span> <span class="n">rms_residual_values_wellsampled_cal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;calibrated&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_values_poorlysampled_cal</span><span class="p">,</span> <span class="n">rms_residual_values_poorlysampled_cal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; model errors / dataset stdev&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RMS Absolute residuals</span><span class="se">\n</span><span class="s1"> / dataset stdev&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Fit the line to all data, including the poorly sampled data, and weight data points by number of samples per bin</span>
        <span class="n">linear_uncal</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_values_uncal</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rms_residual_values_uncal</span><span class="p">,</span>
                         <span class="n">sample_weight</span><span class="o">=</span><span class="n">num_values_per_bin_uncal</span><span class="p">)</span>
        <span class="n">yfit_uncal</span> <span class="o">=</span> <span class="n">linear_uncal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_values_uncal</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_values_uncal</span><span class="p">,</span> <span class="n">yfit_uncal</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">r2_uncal</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">rms_residual_values_uncal</span><span class="p">,</span> <span class="n">yfit_uncal</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">num_values_per_bin_uncal</span><span class="p">)</span>

        <span class="n">slope_uncal</span> <span class="o">=</span> <span class="n">linear_uncal</span><span class="o">.</span><span class="n">coef_</span>
        <span class="n">intercept_uncal</span> <span class="o">=</span> <span class="n">linear_uncal</span><span class="o">.</span><span class="n">intercept_</span>

        <span class="c1"># Fit the line to all data, including the poorly sampled data, and weight data points by number of samples per bin</span>
        <span class="n">linear_cal</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_values_cal</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rms_residual_values_cal</span><span class="p">,</span>
                       <span class="n">sample_weight</span><span class="o">=</span><span class="n">num_values_per_bin_cal</span><span class="p">)</span>
        <span class="n">yfit_cal</span> <span class="o">=</span> <span class="n">linear_cal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_values_cal</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_values_cal</span><span class="p">,</span> <span class="n">yfit_cal</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">r2_cal</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">rms_residual_values_cal</span><span class="p">,</span> <span class="n">yfit_cal</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">num_values_per_bin_cal</span><span class="p">)</span>

        <span class="n">slope_cal</span> <span class="o">=</span> <span class="n">linear_cal</span><span class="o">.</span><span class="n">coef_</span>
        <span class="n">intercept_cal</span> <span class="o">=</span> <span class="n">linear_cal</span><span class="o">.</span><span class="n">intercept_</span>

        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">axbarx</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">axbarx</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bin_values_uncal</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">num_values_per_bin_uncal</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">bin_values_uncal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">bin_values_uncal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bin_values_cal</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">num_values_per_bin_cal</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">bin_values_cal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bin_values_cal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">bin_values_uncal</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">rms_residual_values_uncal</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">ymax</span><span class="p">)</span>
        <span class="n">axbarx</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">num_values_per_bin_uncal</span><span class="p">)</span> <span class="o">+</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">xmax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;R$^2$ = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">r2_uncal</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;slope = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">slope_uncal</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;intercept = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">intercept_uncal</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.6</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;R$^2$ = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">r2_cal</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;slope = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">slope_cal</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">ymax</span><span class="p">,</span> <span class="s1">&#39;intercept = </span><span class="si">%3.2f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">intercept_cal</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">})</span>

        <span class="c1"># Plot y = x line as reference point</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxx</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxx</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_residuals_vs_modelerror_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_uncal_cal_overlay.png&#39;</span><span class="p">),</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_figure</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span></div></div>


<div class="viewcode-block" id="Histogram"><a class="viewcode-back" href="../../api/mastml.plots.Histogram.html#mastml.plots.Histogram">[docs]</a><span class="k">class</span> <span class="nc">Histogram</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to generate histogram plots, such as histograms of residual values</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Methods:</span>
<span class="sd">        plot_histogram: method to plot a basic histogram of supplied data</span>
<span class="sd">            Args:</span>
<span class="sd">                df: (pd.DataFrame), dataframe or series of data to plot as a histogram</span>

<span class="sd">                savepath: (str), string denoting the save path for the figure image</span>

<span class="sd">                file_name: (str), string denoting the character of the file name, e.g. train vs. test</span>

<span class="sd">                x_label: (str), string denoting the  property name</span>

<span class="sd">                show_figure: (bool), whether or not to show the figure output (e.g. when using Jupyter notebook)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        plot_residuals_histogram: method to plot a histogram of residual values</span>
<span class="sd">            Args:</span>
<span class="sd">                y_true: (pd.Series), series of true y data</span>

<span class="sd">                y_pred: (pd.Series), series of predicted y data</span>

<span class="sd">                savepath: (str), string denoting the save path for the figure image</span>

<span class="sd">                file_name: (str), string denoting the character of the file name, e.g. train vs. test</span>

<span class="sd">                show_figure: (bool), whether or not to show the figure output (e.g. when using Jupyter notebook)</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">        _get_histogram_bins: Method to obtain the number of bins to use when plotting a histogram</span>
<span class="sd">            Args:</span>
<span class="sd">                df: (pandas Series or numpy array), array of y data used to construct histogram</span>

<span class="sd">            Returns:</span>
<span class="sd">                num_bins: (int), the number of bins to use when plotting a histogram</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Histogram.plot_histogram"><a class="viewcode-back" href="../../api/mastml.plots.Histogram.html#mastml.plots.Histogram.plot_histogram">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Make the dataframe 1D if it isn&#39;t</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># make fig and ax, use x_align when placing text so things don&#39;t overlap</span>
        <span class="n">x_align</span> <span class="o">=</span> <span class="mf">0.70</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">)</span>

        <span class="c1"># Get num_bins using smarter method</span>
        <span class="n">num_bins</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_histogram_bins</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># do the actual plotting</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">num_bins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="c1"># normal text stuff</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of occurrences&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="n">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()),</span> <span class="n">x_align</span><span class="o">=</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># Save data to excel file and image</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.xlsx&#39;</span><span class="p">))</span>
        <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;_statistics.xlsx&#39;</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_figure</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Histogram.plot_residuals_histogram"><a class="viewcode-back" href="../../api/mastml.plots.Histogram.html#mastml.plots.Histogram.plot_residuals_histogram">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_residuals_histogram</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">savepath</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;residual_histogram&#39;</span><span class="p">):</span>
        <span class="n">y_true</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">check_dimensions</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">-</span><span class="n">y_true</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                           <span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                           <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                           <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Residuals&#39;</span><span class="p">,</span>
                           <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
        <span class="k">return</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_histogram_bins</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="n">bin_dividers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bin_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">divider</span> <span class="ow">in</span> <span class="n">bin_dividers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">divider</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">divider</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bins</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">bin_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">num_bins</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_bins</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bin_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_bins</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="n">num_bins</span></div>


<div class="viewcode-block" id="Line"><a class="viewcode-back" href="../../api/mastml.plots.Line.html#mastml.plots.Line">[docs]</a><span class="k">class</span> <span class="nc">Line</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class containing methods for constructing line plots</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Methods:</span>
<span class="sd">        plot_learning_curve: Method used to plot both data and feature learning curves</span>

<span class="sd">        Args:</span>
<span class="sd">            train_sizes: (numpy array), array of x-axis values, such as fraction of data used or number of features</span>

<span class="sd">            train_mean: (numpy array), array of training data mean values, averaged over some type/number of CV splits</span>

<span class="sd">            test_mean: (numpy array), array of test data mean values, averaged over some type/number of CV splits</span>

<span class="sd">            train_stdev: (numpy array), array of training data standard deviation values, from some type/number of CV splits</span>

<span class="sd">            test_stdev: (numpy array), array of test data standard deviation values, from some type/number of CV splits</span>

<span class="sd">            score_name: (str), type of score metric for learning curve plotting; used in y-axis label</span>

<span class="sd">            learning_curve_type: (str), type of learning curve employed: &#39;sample_learning_curve&#39; or &#39;feature_learning_curve&#39;</span>

<span class="sd">            savepath: (str), path to save the plotted learning curve to</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="Line.plot_learning_curve"><a class="viewcode-back" href="../../api/mastml.plots.Line.html#mastml.plots.Line.plot_learning_curve">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_learning_curve</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_mean</span><span class="p">,</span> <span class="n">test_mean</span><span class="p">,</span> <span class="n">train_stdev</span><span class="p">,</span> <span class="n">test_stdev</span><span class="p">,</span> <span class="n">score_name</span><span class="p">,</span>
                            <span class="n">learning_curve_type</span><span class="p">,</span> <span class="n">savepath</span><span class="p">):</span>

        <span class="c1"># Set image aspect ratio (do custom for learning curve):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
        <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:])</span>

        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">)</span>
        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">)</span>

        <span class="n">max_y</span><span class="p">,</span> <span class="n">min_y</span> <span class="o">=</span> <span class="n">recursive_max_and_min</span><span class="p">([</span>
            <span class="n">train_mean</span><span class="p">,</span>
            <span class="n">train_mean</span> <span class="o">+</span> <span class="n">train_stdev</span><span class="p">,</span>
            <span class="n">train_mean</span> <span class="o">-</span> <span class="n">train_stdev</span><span class="p">,</span>
            <span class="n">test_mean</span><span class="p">,</span>
            <span class="n">test_mean</span> <span class="o">+</span> <span class="n">test_stdev</span><span class="p">,</span>
            <span class="n">test_mean</span> <span class="o">-</span> <span class="n">test_stdev</span><span class="p">,</span>
        <span class="p">])</span>

        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_x</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">))</span>
        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min_x</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">))</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_y</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span><span class="p">))</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">min_y</span><span class="p">),</span> <span class="n">rounder</span><span class="p">(</span><span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span><span class="p">))</span>
        <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">min_y</span><span class="p">)</span>

        <span class="c1"># plot and collect handles h1 and h2 for making legend</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_mean</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_mean</span> <span class="o">-</span> <span class="n">train_stdev</span><span class="p">,</span> <span class="n">train_mean</span> <span class="o">+</span> <span class="n">train_stdev</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_mean</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_mean</span> <span class="o">-</span> <span class="n">test_stdev</span><span class="p">,</span> <span class="n">test_mean</span> <span class="o">+</span> <span class="n">test_stdev</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;train score&#39;</span><span class="p">,</span> <span class="s1">&#39;validation score&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">learning_curve_type</span> <span class="o">==</span> <span class="s1">&#39;data_learning_curve&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of training data points&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">learning_curve_type</span> <span class="o">==</span> <span class="s1">&#39;feature_learning_curve&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of features selected&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;The param &quot;learning_curve_type&quot; must be either &quot;data_learning_curve&quot; or &quot;feature_learning_curve&quot;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">score_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">learning_curve_type</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="make_plots"><a class="viewcode-back" href="../../api/mastml.plots.make_plots.html#mastml.plots.make_plots">[docs]</a><span class="k">def</span> <span class="nf">make_plots</span><span class="p">(</span><span class="n">plots</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">dataset_stdev</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">model_errors</span><span class="p">,</span> <span class="n">has_model_errors</span><span class="p">,</span>
               <span class="n">savepath</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recalibrate_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model_errors_cal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splits_summary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to make collections of different types of plots after a single or multiple data splits are evaluated.</span>

<span class="sd">    Args:</span>
<span class="sd">        plots: (list of str), list denoting which types of plots to make. Viable entries are &quot;Scatter&quot;, &quot;Histogram&quot;, &quot;Error&quot;</span>

<span class="sd">        y_true: (pd.Series), series containing the true y data</span>

<span class="sd">        y_pred: (pd.Series), series containing the predicted y data</span>

<span class="sd">        groups: (list), list denoting the group label for each data point</span>

<span class="sd">        dataset_stdev: (float), the dataset standard deviation</span>

<span class="sd">        metrics: (list of str), list denoting the metric names to evaluate. See mastml.metrics.Metrics.metrics_zoo_ for full list</span>

<span class="sd">        model: (mastml.models object), a MAST-ML model object, e.g. SklearnModel or EnsembleModel</span>

<span class="sd">        residuals: (pd.Series), series containing the residuals (true model errors)</span>

<span class="sd">        model_errors: (pd.Series), series containing the as-obtained uncalibrated model errors</span>

<span class="sd">        has_model_errors: (bool), whether the model type used can be subject to UQ and thus have model errors calculated</span>

<span class="sd">        savepath: (str), string denoting the path to save output to</span>

<span class="sd">        data_type: (str), string denoting the data type analyzed, e.g. train, test, leftout</span>

<span class="sd">        show_figure: (bool), whether or not the generated figure is output to the notebook screen (default False)</span>

<span class="sd">        recalibrate_errors: (bool), whether or not the model errors have been recalibrated (default False)</span>

<span class="sd">        model_errors_cal: (pd.Series), series containing the calibrated predicted model errors</span>

<span class="sd">        splits_summary: (bool), whether or not the data used in the plots comes from a collection of many splits (default False), False denotes a single split folder</span>

<span class="sd">    Returns:</span>
<span class="sd">        None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;Histogram&#39;</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">:</span>
        <span class="n">Histogram</span><span class="o">.</span><span class="n">plot_residuals_histogram</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span>
                                           <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span>
                                           <span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                           <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;residual_histogram_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data_type</span><span class="p">),</span>
                                           <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Scatter&#39;</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">:</span>
        <span class="n">Scatter</span><span class="o">.</span><span class="n">plot_predicted_vs_true</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span>
                                       <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span>
                                       <span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                       <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">,</span>
                                       <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                       <span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                                       <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">splits_summary</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">data_type</span> <span class="o">!=</span> <span class="s1">&#39;leaveout&#39;</span><span class="p">:</span>
            <span class="n">Scatter</span><span class="o">.</span><span class="n">plot_best_worst_split</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                          <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                          <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">,</span>
                                          <span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                                          <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
            <span class="c1"># Commenting out for now as this plot can cause errors for certain datasets with many identical y_true vals</span>
            <span class="c1">#Scatter.plot_best_worst_per_point(savepath=savepath,</span>
            <span class="c1">#                                  data_type=data_type,</span>
            <span class="c1">#                                  x_label=&#39;values&#39;,</span>
            <span class="c1">#                                  metrics_list=metrics,</span>
            <span class="c1">#                                  show_figure=show_figure)</span>
            <span class="n">Scatter</span><span class="o">.</span><span class="n">plot_predicted_vs_true_bars</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                                <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                                <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">,</span>
                                                <span class="n">metrics_list</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                                                <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">Scatter</span><span class="o">.</span><span class="n">plot_metric_vs_group</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                             <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                             <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Error&#39;</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">:</span>
        <span class="n">Error</span><span class="o">.</span><span class="n">plot_normalized_error</span><span class="p">(</span><span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                    <span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                    <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                    <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                                    <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
        <span class="n">Error</span><span class="o">.</span><span class="n">plot_cumulative_normalized_error</span><span class="p">(</span><span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                               <span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                               <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                               <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                                               <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">has_model_errors</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">Error</span><span class="o">.</span><span class="n">plot_rstat</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                             <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                             <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                             <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                             <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">,</span>
                             <span class="n">is_calibrated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">Error</span><span class="o">.</span><span class="n">plot_real_vs_predicted_error</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                               <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                               <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                               <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                                               <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                               <span class="n">dataset_stdev</span><span class="o">=</span><span class="n">dataset_stdev</span><span class="p">,</span>
                                               <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">,</span>
                                               <span class="n">is_calibrated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recalibrate_errors</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">Error</span><span class="o">.</span><span class="n">plot_rstat</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                 <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                 <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                 <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors_cal</span><span class="p">,</span>
                                 <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">,</span>
                                 <span class="n">is_calibrated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">Error</span><span class="o">.</span><span class="n">plot_rstat_uncal_cal_overlay</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                                   <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                                   <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                                   <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                                                   <span class="n">model_errors_cal</span><span class="o">=</span><span class="n">model_errors_cal</span><span class="p">,</span>
                                                   <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">Error</span><span class="o">.</span><span class="n">plot_real_vs_predicted_error</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                                   <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                                   <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                                   <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                                   <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors_cal</span><span class="p">,</span>
                                                   <span class="n">dataset_stdev</span><span class="o">=</span><span class="n">dataset_stdev</span><span class="p">,</span>
                                                   <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span><span class="p">,</span>
                                                   <span class="n">is_calibrated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">Error</span><span class="o">.</span><span class="n">plot_real_vs_predicted_error_uncal_cal_overlay</span><span class="p">(</span><span class="n">savepath</span><span class="o">=</span><span class="n">savepath</span><span class="p">,</span>
                                                                     <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                                                     <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                                                                     <span class="n">model_errors</span><span class="o">=</span><span class="n">model_errors</span><span class="p">,</span>
                                                                     <span class="n">model_errors_cal</span><span class="o">=</span><span class="n">model_errors_cal</span><span class="p">,</span>
                                                                     <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span>
                                                                     <span class="n">dataset_stdev</span><span class="o">=</span><span class="n">dataset_stdev</span><span class="p">,</span>
                                                                     <span class="n">show_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="check_dimensions"><a class="viewcode-back" href="../../api/mastml.plots.check_dimensions.html#mastml.plots.check_dimensions">[docs]</a><span class="k">def</span> <span class="nf">check_dimensions</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to check the dimensions of supplied data. Plotters need data to be 1D and often data is passed in as 2D</span>

<span class="sd">    Args:</span>

<span class="sd">        y: (numpy array or pd.DataFrame), array or dataframe of data used for plotting</span>

<span class="sd">    Returns:</span>

<span class="sd">        y: (pd.Series), series that is now 1D</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="c1">#y = y.ravel()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="reset_index"><a class="viewcode-back" href="../../api/mastml.plots.reset_index.html#mastml.plots.reset_index">[docs]</a><span class="k">def</span> <span class="nf">reset_index</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">))</span></div>


<div class="viewcode-block" id="trim_array"><a class="viewcode-back" href="../../api/mastml.plots.trim_array.html#mastml.plots.trim_array">[docs]</a><span class="k">def</span> <span class="nf">trim_array</span><span class="p">(</span><span class="n">arr_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to trim a set of arrays to make all arrays the same shape</span>

<span class="sd">    Args:</span>

<span class="sd">        arr_list: (list), list of numpy arrays, where arrays are different sizes</span>

<span class="sd">    Returns:</span>

<span class="sd">        arr_list: (), list of trimmed numpy arrays, where arrays are same size</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: a better way to handle arrays with very different shapes? Otherwise average only uses # of points of smallest array</span>
    <span class="c1"># Need to make arrays all same shapes if they aren&#39;t</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arr_list</span><span class="p">]</span>
    <span class="n">size_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
    <span class="n">arr_list_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">size_min</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">size_min</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">arr_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">arr_list</span> <span class="o">=</span> <span class="n">arr_list_</span>
    <span class="k">return</span> <span class="n">arr_list</span></div>


<div class="viewcode-block" id="rounder"><a class="viewcode-back" href="../../api/mastml.plots.rounder.html#mastml.plots.rounder">[docs]</a><span class="k">def</span> <span class="nf">rounder</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to obtain number of decimal places to report on plots</span>

<span class="sd">    Args:</span>

<span class="sd">        delta: (float), a float representing the change in two y values on a plot, used to obtain the plot axis spacing size</span>

<span class="sd">    Return:</span>

<span class="sd">        (int), an integer denoting the number of decimal places to use</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="mf">0.001</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="mf">0.01</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="mf">0.1</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="stat_to_string"><a class="viewcode-back" href="../../api/mastml.plots.stat_to_string.html#mastml.plots.stat_to_string">[docs]</a><span class="k">def</span> <span class="nf">stat_to_string</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">nice_names</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that converts a metric object into a string for displaying on a plot</span>

<span class="sd">    Args:</span>

<span class="sd">        name: (str), long name of a stat metric or quantity</span>

<span class="sd">        value: (float), value of the metric or quantity</span>

<span class="sd">    Return:</span>

<span class="sd">        (str), a string of the metric name, adjusted to look nicer for inclusion on a plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="s2">&quot; Stringifies the name value pair for display within a plot &quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">nice_names</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">nice_names</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="c1"># has a name only</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">name</span>
    <span class="c1"># has a mean and std</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mean</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\pm$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">std</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="c1"># has a name and value only</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># probably a string</span></div>


<div class="viewcode-block" id="plot_stats"><a class="viewcode-back" href="../../api/mastml.plots.plot_stats.html#mastml.plots.plot_stats">[docs]</a><span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">y_align</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">font_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that prints stats onto the plot. Goes off screen if they are too long or too many in number.</span>

<span class="sd">    Args:</span>

<span class="sd">        fig: (matplotlib figure object), a matplotlib figure object</span>

<span class="sd">        stats: (dict), dict of statistics to be included with a plot</span>

<span class="sd">        x_align: (float), float denoting x position of where to align display of stats on a plot</span>

<span class="sd">        y_align: (float), float denoting y position of where to align display of stats on a plot</span>

<span class="sd">        font_dict: (dict), dict of matplotlib font options to alter display of stats on plot</span>

<span class="sd">        fontsize: (int), the fontsize of stats to display on plot</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stat_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stat_to_string</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">nice_names</span><span class="o">=</span><span class="n">nice_names</span><span class="p">())</span>
                         <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_align</span><span class="p">,</span> <span class="n">y_align</span><span class="p">,</span> <span class="n">stat_str</span><span class="p">,</span>
             <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font_dict</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">))</span></div>


<div class="viewcode-block" id="make_fig_ax"><a class="viewcode-back" href="../../api/mastml.plots.make_fig_ax.html#mastml.plots.make_fig_ax">[docs]</a><span class="k">def</span> <span class="nf">make_fig_ax</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">x_align</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to make matplotlib figure and axes objects. Using Object Oriented interface from https://matplotlib.org/gallery/api/agg_oo_sgskip.html</span>

<span class="sd">    Args:</span>

<span class="sd">        aspect_ratio: (float), aspect ratio for figure and axes creation</span>

<span class="sd">        x_align: (float), x position to draw edge of figure. Needed so can display stats alongside plot</span>

<span class="sd">        left: (float), the leftmost position to draw edge of figure</span>

<span class="sd">    Returns:</span>

<span class="sd">        fig: (matplotlib fig object), a matplotlib figure object with the specified aspect ratio</span>

<span class="sd">        ax: (matplotlib ax object), a matplotlib axes object with the specified aspect ratio</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set image aspect ratio:</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    <span class="c1">#fig = Figure(figsize=(w, h))</span>
    <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># Set custom positioning, see this guide for more details:</span>
    <span class="c1"># https://python4astronomers.github.io/plotting/advanced.html</span>
    <span class="c1">#left   = 0.10</span>
    <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">right</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">top</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">x_align</span> <span class="o">-</span> <span class="n">left</span> <span class="o">-</span> <span class="n">right</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="make_fig_ax_square"><a class="viewcode-back" href="../../api/mastml.plots.make_fig_ax_square.html#mastml.plots.make_fig_ax_square">[docs]</a><span class="k">def</span> <span class="nf">make_fig_ax_square</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to make square shaped matplotlib figure and axes objects. Using Object Oriented interface from</span>

<span class="sd">    https://matplotlib.org/gallery/api/agg_oo_sgskip.html</span>

<span class="sd">    Args:</span>

<span class="sd">        aspect: (str), &#39;equal&#39; denotes x and y aspect will be equal (i.e. square)</span>

<span class="sd">        aspect_ratio: (float), aspect ratio for figure and axes creation</span>

<span class="sd">    Returns:</span>

<span class="sd">        fig: (matplotlib fig object), a matplotlib figure object with the specified aspect ratio</span>

<span class="sd">        ax: (matplotlib ax object), a matplotlib axes object with the specified aspect ratio</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set image aspect ratio:</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">figaspect</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="make_axis_same"><a class="viewcode-back" href="../../api/mastml.plots.make_axis_same.html#mastml.plots.make_axis_same">[docs]</a><span class="k">def</span> <span class="nf">make_axis_same</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max1</span><span class="p">,</span> <span class="n">min1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to make the x and y ticks for each axis the same. Useful for parity plots</span>

<span class="sd">    Args:</span>

<span class="sd">        ax: (matplotlib axis object), a matplotlib axes object</span>

<span class="sd">        max1: (float), the maximum value of a particular axis</span>

<span class="sd">        min1: (float), the minimum value of a particular axis</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max1</span> <span class="o">-</span> <span class="n">min1</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">max1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">min1</span><span class="p">))</span> <span class="o">//</span> <span class="mi">3</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">min1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max1</span><span class="p">)</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span></div>


<div class="viewcode-block" id="nice_mean"><a class="viewcode-back" href="../../api/mastml.plots.nice_mean.html#mastml.plots.nice_mean">[docs]</a><span class="k">def</span> <span class="nf">nice_mean</span><span class="p">(</span><span class="n">ls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return mean of a list or equivalent array with NaN values</span>

<span class="sd">    Args:</span>

<span class="sd">        ls: (list), list of values</span>

<span class="sd">    Returns:</span>

<span class="sd">        (numpy array), array containing mean of list of values or NaN if list has no values</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="nice_std"><a class="viewcode-back" href="../../api/mastml.plots.nice_std.html#mastml.plots.nice_std">[docs]</a><span class="k">def</span> <span class="nf">nice_std</span><span class="p">(</span><span class="n">ls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return standard deviation of a list or equivalent array with NaN values</span>

<span class="sd">    Args:</span>

<span class="sd">        ls: (list), list of values</span>

<span class="sd">    Returns:</span>

<span class="sd">        (numpy array), array containing standard deviation of list of values or NaN if list has no values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="round_down"><a class="viewcode-back" href="../../api/mastml.plots.round_down.html#mastml.plots.round_down">[docs]</a><span class="k">def</span> <span class="nf">round_down</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return a rounded down number</span>

<span class="sd">    Args:</span>

<span class="sd">        num: (float), a number to round down</span>

<span class="sd">        divisor: (int), divisor to denote how to round down</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), the rounded-down number</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">num</span> <span class="o">-</span> <span class="p">(</span><span class="n">num</span> <span class="o">%</span> <span class="n">divisor</span><span class="p">)</span></div>


<div class="viewcode-block" id="round_up"><a class="viewcode-back" href="../../api/mastml.plots.round_up.html#mastml.plots.round_up">[docs]</a><span class="k">def</span> <span class="nf">round_up</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return a rounded up number</span>

<span class="sd">    Args:</span>

<span class="sd">        num: (float), a number to round up</span>

<span class="sd">        divisor: (int), divisor to denote how to round up</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), the rounded-up number</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">))</span> <span class="o">*</span> <span class="n">divisor</span></div>


<div class="viewcode-block" id="get_divisor"><a class="viewcode-back" href="../../api/mastml.plots.get_divisor.html#mastml.plots.get_divisor">[docs]</a><span class="k">def</span> <span class="nf">get_divisor</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to obtain a sensible divisor based on range of two values</span>

<span class="sd">    Args:</span>

<span class="sd">        high: (float), a max data value</span>

<span class="sd">        low: (float), a min data value</span>

<span class="sd">    Returns:</span>

<span class="sd">        divisor: (float), a number used to make sensible axis ticks</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">high</span><span class="o">-</span><span class="n">low</span>
    <span class="n">divisor</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="n">divisor</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">divisor</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">divisor</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">divisor</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
                        <span class="n">divisor</span> <span class="o">=</span> <span class="mf">0.001</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">divisor</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="k">return</span> <span class="n">divisor</span></div>


<div class="viewcode-block" id="recursive_max"><a class="viewcode-back" href="../../api/mastml.plots.recursive_max.html#mastml.plots.recursive_max">[docs]</a><span class="k">def</span> <span class="nf">recursive_max</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to recursively find the max value of an array of iterables.</span>

<span class="sd">    Credit: https://www.linkedin.com/pulse/ask-recursion-during-coding-interviews-identify-good-talent-veteanu/</span>

<span class="sd">    Args:</span>

<span class="sd">        arr: (numpy array), an array of values or iterables</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), max value in arr</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
        <span class="n">recursive_max</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">arr</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="recursive_min"><a class="viewcode-back" href="../../api/mastml.plots.recursive_min.html#mastml.plots.recursive_min">[docs]</a><span class="k">def</span> <span class="nf">recursive_min</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to recursively find the min value of an array of iterables.</span>

<span class="sd">    Credit: https://www.linkedin.com/pulse/ask-recursion-during-coding-interviews-identify-good-talent-veteanu/</span>

<span class="sd">    Args:</span>

<span class="sd">        arr: (numpy array), an array of values or iterables</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), min value in arr</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">recursive_min</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">arr</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="recursive_max_and_min"><a class="viewcode-back" href="../../api/mastml.plots.recursive_max_and_min.html#mastml.plots.recursive_max_and_min">[docs]</a><span class="k">def</span> <span class="nf">recursive_max_and_min</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to recursively return max and min of values or iterables in array</span>

<span class="sd">    Args:</span>

<span class="sd">        arr: (numpy array), an array of values or iterables</span>

<span class="sd">    Returns:</span>

<span class="sd">        (tuple), tuple containing max and min of arr</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">recursive_max</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">recursive_min</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_set_tick_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that sets the x and y ticks to be in the same range</span>

<span class="sd">    Args:</span>

<span class="sd">        ax: (matplotlib axes object), a matplotlib axes object</span>

<span class="sd">        maxx: (float), a maximum value</span>

<span class="sd">        minn: (float), a minimum value</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">minn</span><span class="p">)</span>  <span class="c1"># I love it when this happens</span>


<span class="k">def</span> <span class="nf">_set_tick_labels_different</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">max_tick_x</span><span class="p">,</span> <span class="n">min_tick_x</span><span class="p">,</span> <span class="n">max_tick_y</span><span class="p">,</span> <span class="n">min_tick_y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that sets the x and y ticks, when the axes have different ranges</span>

<span class="sd">    Args:</span>

<span class="sd">        ax: (matplotlib axes object), a matplotlib axes object</span>

<span class="sd">        max_tick_x: (float), the maximum tick value for the x axis</span>

<span class="sd">        min_tick_x: (float), the minimum tick value for the x axis</span>

<span class="sd">        max_tick_y: (float), the maximum tick value for the y axis</span>

<span class="sd">        min_tick_y: (float), the minimum tick value for the y axis</span>

<span class="sd">    Returns:</span>

<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tickvals_x</span> <span class="o">=</span> <span class="n">nice_range</span><span class="p">(</span><span class="n">min_tick_x</span><span class="p">,</span> <span class="n">max_tick_x</span><span class="p">)</span>
    <span class="n">tickvals_y</span> <span class="o">=</span> <span class="n">nice_range</span><span class="p">(</span><span class="n">min_tick_y</span><span class="p">,</span> <span class="n">max_tick_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tickvals_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tickvals_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_x</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_x</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">tickvals_x</span> <span class="o">=</span> <span class="n">tickvals_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tickvals_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_y</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tickvals_y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_y</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals_y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tickvals_y</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">tickvals_y</span> <span class="o">=</span> <span class="n">tickvals_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#tickvals_x = _clean_tick_labels(tickvals=tickvals_x, delta=max_tick_x-min_tick_x)</span>
    <span class="c1">#tickvals_y = _clean_tick_labels(tickvals=tickvals_y, delta=max_tick_y - min_tick_y)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">tickvals_x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">tickvals_y</span><span class="p">)</span>

    <span class="n">ticklabels_x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">tickvals_x</span><span class="p">]</span>
    <span class="n">ticklabels_y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">tickvals_y</span><span class="p">]</span>

    <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Look at length of x tick labels to see if may be possibly crowded. If so, rotate labels</span>
    <span class="n">tick_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tickvals_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">tick_length</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">ticklabels_x</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">ticklabels_y</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_clean_tick_labels</span><span class="p">(</span><span class="n">tickvals</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to attempt to clean up axis tick values so they don&#39;t overlap from being too dense</span>

<span class="sd">    Args:</span>

<span class="sd">        tickvals: (list), a list containing the initial axis tick values</span>

<span class="sd">        delta: (float), number representing the numerical difference of two ticks</span>

<span class="sd">    Returns:</span>

<span class="sd">        tickvals_clean: (list), a list containing the updated axis tick values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tickvals_clean</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tickvals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tickvals</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tickvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">tickvals</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="n">tickvals_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tickvals_clean</span> <span class="o">=</span> <span class="n">tickvals</span>
    <span class="k">return</span> <span class="n">tickvals_clean</span>

<span class="c1"># Math utilities to aid plot_helper to make ranges</span>


<div class="viewcode-block" id="nice_range"><a class="viewcode-back" href="../../api/mastml.plots.nice_range.html#mastml.plots.nice_range">[docs]</a><span class="k">def</span> <span class="nf">nice_range</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to create a range of values, including the specified start and end points, with nicely spaced intervals</span>

<span class="sd">    Args:</span>

<span class="sd">        lower: (float or int), lower bound of range to create</span>

<span class="sd">        upper: (float or int), upper bound of range to create</span>

<span class="sd">    Returns:</span>

<span class="sd">        (list), list of numerical values in established range</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">flipped</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># set to -1 for inverted</span>

    <span class="c1"># Case for validation where nan is passed in</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lower</span><span class="p">):</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">upper</span><span class="p">):</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">if</span> <span class="n">upper</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">:</span>
        <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
        <span class="n">flipped</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">_int_if_int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_nice_range_helper</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)][::</span><span class="n">flipped</span><span class="p">]</span></div>


<span class="k">def</span> <span class="nf">_nice_range_helper</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to help make a better range of axis ticks</span>

<span class="sd">    Args:</span>

<span class="sd">        lower: (float), lower value of axis ticks</span>

<span class="sd">        upper: (float), upper value of axis ticks</span>

<span class="sd">    Returns:</span>

<span class="sd">        upper: (float), modified upper tick value fixed based on set of axis ticks</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="n">upper</span><span class="p">)</span>

    <span class="c1"># special case where lower and upper are the same</span>
    <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">lower</span><span class="p">,</span> <span class="p">]</span>

    <span class="c1"># the exact step needed</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">/</span> <span class="n">steps</span>

    <span class="c1"># a rough estimate of best step</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">_nearest_pow_ten</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>  <span class="c1"># whole decimal increments</span>

    <span class="c1"># tune in one the best step size</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

    <span class="c1"># use this to minimize how far we are from ideal step size</span>
    <span class="k">def</span> <span class="nf">best_one</span><span class="p">(</span><span class="n">steps_factor</span><span class="p">):</span>
        <span class="n">steps_count</span><span class="p">,</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">steps_factor</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">steps_count</span> <span class="o">-</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">n_steps</span><span class="p">,</span> <span class="n">best_factor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([(</span><span class="n">diff</span> <span class="o">/</span> <span class="p">(</span><span class="n">step</span> <span class="o">*</span> <span class="n">f</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">best_one</span><span class="p">)</span>

    <span class="c1">#print(&#39;should see n steps&#39;, ceil(n_steps + 2))</span>
    <span class="c1"># multiply in the optimal factor for getting as close to ten steps as we can</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">best_factor</span>

    <span class="c1"># make the bounds look nice</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">_three_sigfigs</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">_three_sigfigs</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">_round_up</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="c1"># prepare for iteration</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">start</span>  <span class="c1"># pointless init</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># itereate until we reach upper</span>
    <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">upper</span> <span class="o">-</span> <span class="n">step</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">yield</span> <span class="n">_three_sigfigs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># using sigfigs because of floating point error</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># finish off with ending bound</span>
    <span class="k">yield</span> <span class="n">upper</span>


<span class="k">def</span> <span class="nf">_three_sigfigs</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method invoking special case of _n_sigfigs to return 3 sig figs</span>

<span class="sd">    Args:</span>

<span class="sd">        x: (float), an axis tick number</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), number of sig figs (always 3)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_n_sigfigs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_n_sigfigs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return number of sig figs to use for axis ticks</span>

<span class="sd">    Args:</span>

<span class="sd">        x: (float), an axis tick number</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), number of sig figs</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># case for negatives</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_nearest_pow_ten</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return the nearest power of ten for an axis tick value</span>

<span class="sd">    Args:</span>

<span class="sd">        x: (float), an axis tick number</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), nearest power of ten of x</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># case for negatives</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">sign</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="n">ceil</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_int_if_int</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return integer mapped value of x</span>

<span class="sd">    Args:</span>

<span class="sd">        x: (float or int), a number</span>

<span class="sd">    Returns:</span>

<span class="sd">        x: (float), value of x mapped as integer</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">_round_up</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to round up the value of x</span>

<span class="sd">    Args:</span>

<span class="sd">        x: (float or int), a number</span>

<span class="sd">        inc: (float), an increment for axis ticks</span>

<span class="sd">    Returns:</span>

<span class="sd">        (float), value of x rounded up</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># case for negative</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">inc</span> <span class="o">*</span> <span class="n">ceil</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">inc</span><span class="p">)</span>


<div class="viewcode-block" id="nice_names"><a class="viewcode-back" href="../../api/mastml.plots.nice_names.html#mastml.plots.nice_names">[docs]</a><span class="k">def</span> <span class="nf">nice_names</span><span class="p">():</span>
    <span class="n">nice_names</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># classification:</span>
        <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="s1">&#39;Accuracy&#39;</span><span class="p">,</span>
        <span class="s1">&#39;f1_binary&#39;</span><span class="p">:</span> <span class="s1">&#39;$F_1$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;f1_macro&#39;</span><span class="p">:</span> <span class="s1">&#39;f1_macro&#39;</span><span class="p">,</span>
        <span class="s1">&#39;f1_micro&#39;</span><span class="p">:</span> <span class="s1">&#39;f1_micro&#39;</span><span class="p">,</span>
        <span class="s1">&#39;f1_samples&#39;</span><span class="p">:</span> <span class="s1">&#39;f1_samples&#39;</span><span class="p">,</span>
        <span class="s1">&#39;f1_weighted&#39;</span><span class="p">:</span> <span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span>
        <span class="s1">&#39;log_loss&#39;</span><span class="p">:</span> <span class="s1">&#39;log_loss&#39;</span><span class="p">,</span>
        <span class="s1">&#39;precision_binary&#39;</span><span class="p">:</span> <span class="s1">&#39;Precision&#39;</span><span class="p">,</span>
        <span class="s1">&#39;precision_macro&#39;</span><span class="p">:</span> <span class="s1">&#39;prec_macro&#39;</span><span class="p">,</span>
        <span class="s1">&#39;precision_micro&#39;</span><span class="p">:</span> <span class="s1">&#39;prec_micro&#39;</span><span class="p">,</span>
        <span class="s1">&#39;precision_samples&#39;</span><span class="p">:</span> <span class="s1">&#39;prec_samples&#39;</span><span class="p">,</span>
        <span class="s1">&#39;precision_weighted&#39;</span><span class="p">:</span> <span class="s1">&#39;prec_weighted&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recall_binary&#39;</span><span class="p">:</span> <span class="s1">&#39;Recall&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recall_macro&#39;</span><span class="p">:</span> <span class="s1">&#39;rcl_macro&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recall_micro&#39;</span><span class="p">:</span> <span class="s1">&#39;rcl_micro&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recall_samples&#39;</span><span class="p">:</span> <span class="s1">&#39;rcl_samples&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recall_weighted&#39;</span><span class="p">:</span> <span class="s1">&#39;rcl_weighted&#39;</span><span class="p">,</span>
        <span class="s1">&#39;roc_auc&#39;</span><span class="p">:</span> <span class="s1">&#39;ROC_AUC&#39;</span><span class="p">,</span>
        <span class="c1"># regression:</span>
        <span class="s1">&#39;explained_variance&#39;</span><span class="p">:</span> <span class="s1">&#39;expl_var&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">:</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mean_squared_error&#39;</span><span class="p">:</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mean_squared_log_error&#39;</span><span class="p">:</span> <span class="s1">&#39;MSLE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;median_absolute_error&#39;</span><span class="p">:</span> <span class="s1">&#39;MedAE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;root_mean_squared_error&#39;</span><span class="p">:</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rmse_over_stdev&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;RMSE/$\sigma_y$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;r2_score&#39;</span><span class="p">:</span> <span class="s1">&#39;$R^2$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;r2_score_noint&#39;</span><span class="p">:</span> <span class="s1">&#39;$R^2_</span><span class="si">{noint}</span><span class="s1">$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;r2_score_adjusted&#39;</span><span class="p">:</span> <span class="s1">&#39;$R^2_</span><span class="si">{adjusted}</span><span class="s1">$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;r2_score_fitted&#39;</span><span class="p">:</span> <span class="s1">&#39;$R^2_</span><span class="si">{fitted}</span><span class="s1">$&#39;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nice_names</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2021, University of Wisconsin-Madison Computational Materials Group

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>